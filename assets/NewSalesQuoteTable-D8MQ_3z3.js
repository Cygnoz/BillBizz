import{r as g,u as st,j as n,am as nt,w as D,g as ot,L as rt,P as L,T as ct,_ as q,e as at}from"./index-A_edQTkL.js";const dt=({salesQuoteState:l,setSalesQuoteState:m,isIntraState:i,oneOrganization:v,isPlaceOfSupplyVisible:p})=>{const[I,P]=g.useState(null),[_,k]=g.useState(null),[E,J]=g.useState(""),[y,H]=g.useState([]),[M,$]=g.useState(!1),{request:z}=st("get",5003),G=g.useRef([]),w=g.useRef(null),[u,f]=g.useState([{itemId:"",itemImage:"",itemName:"",quantity:"",sellingPrice:"",taxPreference:"",taxGroup:"",cgst:"",sgst:"",igst:"",cgstAmount:"",sgstAmount:"",igstAmount:"",vatAmount:0,itemTotalTax:"",discountType:"Percentage",discountAmount:"",amount:"",itemAmount:"",itemStock:"",salesAccountId:""}]),K=(t,e,s)=>{s.itemName||(P(o=>o===t?null:t),k(e))},R=t=>{w.current&&!w.current.contains(t.target)&&(P(null),k(null))};g.useEffect(()=>(I!==null?document.addEventListener("mousedown",R):document.removeEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}),[I]);const U=()=>{const t={itemId:"",itemImage:"",itemName:"",quantity:"",sellingPrice:"",taxPreference:"",taxGroup:"",cgst:"",sgst:"",igst:"",cgstAmount:"",sgstAmount:"",igstAmount:"",vatAmount:"",itemTotalTax:"",discountType:"Percentage",discountAmount:"",amount:"",itemAmount:"",itemStock:"",salesAccountId:""},e=[...u,t];f(e)},N=(t,e,s)=>{let o=parseFloat(e)||0;return o<0?(q.error("Discount cannot be negative"),t):s==="Percentage"?(o>100&&(o=100,q.error("Discount cannot exceed 100%")),t-t*o/100):(o>t&&(o=t,q.error("Discount cannot exceed the selling price")),t-o)},W=(t,e)=>{P(null),k(null);const s=[...u];s[e]={...s[e],itemName:t.itemName,itemImage:t.itemImage,sellingPrice:t.sellingPrice||"0",quantity:"1",itemId:t._id,cgst:t.cgst,sgst:t.sgst,igst:t.igst,taxPreference:t.taxPreference,taxGroup:t.taxRate,itemStock:t.currentStock,salesAccountId:t.salesAccountId};const o=parseFloat(s[e].sellingPrice),r=N(o,s[e].discountAmount,s[e].discountType),{itemAmount:c,cgstAmount:d,sgstAmount:a,igstAmount:x}=T(r,s[e],i);s[e].amount=c,s[e].cgstAmount=p?d:"0.00",s[e].sgstAmount=p?a:"0.00",s[e].igstAmount=p?x:"0.00",s[e].itemAmount=p?i?(parseFloat(c)+parseFloat(x)).toFixed(2):(parseFloat(c)+parseFloat(d)+parseFloat(a)).toFixed(2):parseFloat(c).toFixed(2),f(s),m==null||m(A=>({...A,items:s.map(F=>{const h={...F};return delete h.itemImage,h})}))},T=(t,e,s)=>{if(!M)return{itemAmount:t.toFixed(2),cgstAmount:"0.00",sgstAmount:"0.00",igstAmount:"0.00"};const o=parseFloat((e==null?void 0:e.cgst)||"0"),r=parseFloat((e==null?void 0:e.sgst)||"0"),c=parseFloat((e==null?void 0:e.igst)||"0");if(s){const d=(t*c/100).toFixed(2);return{itemAmount:t.toFixed(2),cgstAmount:"0.00",sgstAmount:"0.00",igstAmount:d}}else{const d=(t*o/100).toFixed(2),a=(t*r/100).toFixed(2);return{itemAmount:t.toFixed(2),cgstAmount:d,sgstAmount:a,igstAmount:"0.00"}}},j=(t,e,s)=>{const o=[...u];o[t]={...o[t],[e]:s};const r=parseFloat(o[t].quantity)||0,c=parseFloat(o[t].sellingPrice)||0,d=r*c,a=N(d,o[t].discountAmount,o[t].discountType),{itemAmount:x,cgstAmount:A,sgstAmount:F,igstAmount:h}=T(a,o[t],i);o[t].amount=x,p?(o[t].cgstAmount=A,o[t].sgstAmount=F,o[t].igstAmount=h):(o[t].cgstAmount="0",o[t].sgstAmount="0",o[t].igstAmount=h),o[t].itemAmount=p?i?(parseFloat(x)+parseFloat(h)).toFixed(2):(parseFloat(x)+parseFloat(A)+parseFloat(F)).toFixed(2):parseFloat(x).toFixed(2),f(o),m==null||m(b=>({...b,items:o.map(C=>{const B={...C};return delete B.itemImage,B})}))};g.useEffect(()=>{const e=((s,o,r)=>s.map(c=>{const d=parseFloat(c.sellingPrice)||0,a=parseFloat(c.quantity)||1,x=N(d,c.discountAmount,c.discountType),{itemAmount:A,cgstAmount:F,sgstAmount:h,igstAmount:b}=T(x,c,o),C=r?o?((parseFloat(A)+parseFloat(b))*a).toFixed(2):((parseFloat(A)+parseFloat(F)+parseFloat(h))*a).toFixed(2):(parseFloat(A)*a).toFixed(2);return{...c,amount:(parseFloat(A)*a).toFixed(2),cgstAmount:r?(parseFloat(F)*a).toFixed(2):"0",sgstAmount:r?(parseFloat(h)*a).toFixed(2):"0",igstAmount:r?(parseFloat(b)*a).toFixed(2):b,itemAmount:C}}))(u,i,p);JSON.stringify(u)!==JSON.stringify(e)&&(f(e),m==null||m(s=>({...s,items:e.map(o=>{const r={...o};return delete r.itemImage,r}),totalTax:e.reduce((o,r)=>o+parseFloat(r.cgstAmount)+parseFloat(r.sgstAmount)+parseFloat(r.igstAmount),0).toFixed(2)})))},[i,p,u]);const X=async()=>{try{const t=`${at.GET_ALL_ITEMS_SALES}`,e=await z(t),{response:s,error:o}=e;!o&&s?(console.log(s.data,"itemsasales"),H(s.data)):console.log(o)}catch(t){console.error("Error fetching items:",t)}},Y=t=>{f(e=>{const s=e.filter((r,c)=>c!==t),o=s.length>0?s:[{itemId:"",itemImage:"",itemName:"",quantity:"",sellingPrice:"",taxPreference:"",taxGroup:"",cgst:"0",sgst:"0",igst:"0",cgstAmount:"",sgstAmount:"",igstAmount:"",vatAmount:"",itemTotalTax:"",discountType:"Percentage",discountAmount:"",amount:"0",itemAmount:"0",itemStock:"",salesAccountId:""}];return m==null||m(r=>({...r,items:o.map(c=>{const d={...c};return delete d.itemImage,d})})),o})},Z=()=>u.reduce((t,e)=>{const s=i?0:parseFloat(e.sgstAmount)||0;return t+s},0),O=()=>u.reduce((t,e)=>{const s=i?0:parseFloat(e.cgstAmount)||0;return t+s},0),V=()=>u.reduce((t,e)=>{const s=i&&parseFloat(e.igstAmount)||0;return t+s},0),Q=()=>u.reduce((t,e)=>{const s=parseFloat(e.quantity)||0;return t+s},0),S=()=>u.reduce((t,e)=>{const s=parseFloat(e.discountAmount)||0,o=parseFloat(e.quantity)||0,c=(parseFloat(e.sellingPrice)||0)*o;return e.discountType==="Percentage"?t+c*s/100:t+s},0),tt=()=>u.reduce((t,e)=>{const s=parseFloat(e.quantity)||0,o=parseFloat(e.sellingPrice)||0,r=s*o;return t+r},0);g.useEffect(()=>{const t=Q(),e=Z(),s=O(),o=V(),r=tt(),c=S(),d=l==null?void 0:l.items.map(a=>{const x=parseFloat(a.cgstAmount)||0,A=parseFloat(a.sgstAmount)||0,F=parseFloat(a.igstAmount)||0,h=i?F:x+A;return{...a,itemTotalTax:h.toFixed(2)}});m==null||m(a=>({...a,totalItem:t,sgst:e.toFixed(2),cgst:s.toFixed(2),igst:o.toFixed(2),subtotalTotal:r.toFixed(2),totalItemDiscount:c.toFixed(2),totalTax:(i?o:e+s).toFixed(2),itemTotalTax:(i?o:e+s).toFixed(2),items:d,subTotal:(r+(i?o:e+s)-c).toFixed(2)}))},[u]);const et=()=>y.filter(t=>!u.find(s=>s.itemId===t._id)&&t.itemName.toLowerCase().includes(E.toLowerCase()));return g.useEffect(()=>{l!=null&&l.taxPreference&&($(l.taxPreference==="Taxable"),f(t=>t.map(e=>{const s=parseFloat(e.sellingPrice),o=N(s,e.discountAmount,e.discountType),{itemAmount:r,cgstAmount:c,sgstAmount:d,igstAmount:a}=T(o,e,i);return{...e,amount:r,cgstAmount:p?c:"0.00",sgstAmount:p?d:"0.00",igstAmount:p?a:"0.00",itemAmount:p?i?(parseFloat(r)+parseFloat(a)).toFixed(2):(parseFloat(r)+parseFloat(c)+parseFloat(d)).toFixed(2):parseFloat(r).toFixed(2)}})))},[l==null?void 0:l.taxPreference]),g.useEffect(()=>{f(t=>Array.isArray(t)?t==null?void 0:t.map(e=>({...e,itemDiscountType:"Percentage",itemDiscount:""})):[])},[]),g.useEffect(()=>{if(l!=null&&l.items&&JSON.stringify(l.items)!==JSON.stringify(G.current)){const t=l.items.map(e=>{const s=y.find(o=>o._id===e.itemId);return{...e,itemStock:(s==null?void 0:s.currentStock)||"",salesAccountId:(s==null?void 0:s.salesAccountId)||e.salesAccountId||""}});f(t),G.current=l.items}},[l==null?void 0:l.items,y]),g.useEffect(()=>{X()},[]),n.jsxs("div",{children:[n.jsx("div",{className:"rounded-lg border-2 border-tableBorder mt-5",children:n.jsxs("table",{className:"min-w-full bg-white rounded-lg relative pb-4 border-dropdownText",children:[n.jsx("thead",{className:"text-[12px] text-center text-dropdownText",children:n.jsx("tr",{className:"bg-lightPink",children:nt.map((t,e)=>n.jsx("th",{className:"py-2 px-4 font-medium border-b border-tableBorder relative",children:t},e))})}),n.jsx("tbody",{className:"text-dropdownText text-center text-[13px] ",children:u==null?void 0:u.map((t,e)=>n.jsxs("tr",{children:[n.jsx("td",{className:"border-y py-3 px-2 border-tableBorder",children:e+1}),n.jsxs("td",{className:"border-y py-3 px-2 border-tableBorder",children:[n.jsx("div",{className:"relative w-full",onClick:()=>K(e,"searchProduct",t),children:t.itemName?n.jsxs("div",{className:"cursor-pointer gap-2 grid grid-cols-12 appearance-none items-center justify-center h-9 text-zinc-400 bg-white text-sm",children:[n.jsx("div",{className:"flex items-start col-span-4",children:n.jsx("img",{className:"rounded-full h-10 w-10 ",src:t.itemImage,alt:""})}),n.jsx("div",{className:"col-span-8  text-start",children:n.jsx("p",{className:"text-textColor",children:t.itemName})})]}):n.jsxs("div",{className:"cursor-pointer flex appearance-none items-center justify-center h-9 text-zinc-400 bg-white text-sm",children:[n.jsx("p",{children:"Type or click"}),n.jsx(D,{color:"currentColor"})]})}),I===e&&_==="searchProduct"&&n.jsxs("div",{ref:w,className:"absolute z-10 bg-white shadow rounded-md -ms-2 p-2 w-[40%] space-y-1 max-h-[250px] overflow-y-scroll",children:[n.jsx(ot,{searchValue:E,onSearchChange:J,placeholder:"Select Item"}),y.length>0?et().map((s,o)=>n.jsxs("div",{className:"grid grid-cols-12 gap-1 p-2 hover:bg-gray-100 cursor-pointer border border-slate-400 rounded-lg bg-lightPink",onClick:()=>W(s,e),children:[n.jsx("div",{className:"col-span-2 flex justify-center",children:n.jsx("img",{className:"rounded-full h-10",src:s.itemImage,alt:""})}),n.jsx("div",{className:"col-span-10 flex",children:n.jsxs("div",{className:"text-start",children:[n.jsx("p",{className:"font-bold text-sm text-black",children:s.itemName}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Rate: RS.",s.sellingPrice]})]})})]},o)):n.jsx("div",{className:"text-center border-slate-400 border rounded-lg",children:n.jsx("p",{className:"text-[red] text-sm py-4",children:"Items Not Found!"})}),n.jsx("div",{children:n.jsx(rt,{to:"/inventory/Item/new",children:n.jsxs("button",{className:`bg-darkGreen text-darkRed rounded-lg py-4 px-6 flex ]\r
                            items-center text-sm font-bold border-slate-400 border gap-2 w-full hover:bg-lightRed`,children:[n.jsx(L,{color:"darkRed"}),n.jsx("p",{children:" Add New Item"})]})})})]})]}),n.jsxs("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:[n.jsx("input",{type:"number",placeholder:"0",className:"w-[50px]  text-center focus:outline-none ",value:t.quantity,onChange:s=>j(e,"quantity",s.target.value)}),n.jsxs("div",{className:"text-center text-[10px]",children:[" ",n.jsxs("p",{children:["Stock OnHand:  ",n.jsx("b",{className:"text-[12px]",children:t.itemStock})," "]})]})]}),n.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:n.jsx("input",{type:"number",placeholder:"0",className:"w-[50px]  focus:outline-none text-center",value:t.sellingPrice,onChange:s=>j(e,"sellingPrice",s.target.value)})}),n.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:n.jsx("input",{disabled:!0,type:"number",placeholder:"0",className:"w-[50px] focus:outline-none text-center",value:p?i?parseFloat(t.igstAmount||"0")===0?"nil":parseFloat(t.igstAmount||"0").toFixed(2):parseFloat(t.cgstAmount||"0")+parseFloat(t.sgstAmount||"0")===0?"nil":(parseFloat(t.cgstAmount||"0")+parseFloat(t.sgstAmount||"0")).toFixed(2):"0"})}),n.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:n.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[n.jsx("input",{type:"number",placeholder:"0",className:"w-[50px]  focus:outline-none text-center",value:t.discountAmount,onChange:s=>j(e,"discountAmount",s.target.value)}),n.jsxs("div",{className:"relative",children:[n.jsxs("select",{onChange:s=>j(e,"discountType",s.target.value),value:t.discountType,className:"text-xs appearance-none w-[60px] p-1 text-zinc-400 bg-white border border-inputBorder rounded-lg",children:[n.jsx("option",{value:"Percentage",children:"%"}),n.jsx("option",{value:"Currency",children:v==null?void 0:v.baseCurrency})]}),n.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:n.jsx(D,{color:"gray",height:15,width:15})})]})]})}),n.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:n.jsx("input",{disabled:!0,type:"number",placeholder:"0",className:"w-[50px]  focus:outline-none text-center",value:t.itemAmount,onChange:s=>j(e,"itemAmount",s.target.value)})}),n.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:n.jsx("div",{className:"text-center flex justify-center gap-2 cursor-pointer",onClick:()=>Y(e),children:n.jsx(ct,{color:"darkRed"})})})]},e))})]})}),n.jsx("div",{className:"w-[60%] mt-0",children:n.jsxs("button",{type:"button",className:"bg-darkGreen text-darkRed rounded-lg py-2 px-1 flex items-center text-sm font-bold",onClick:U,children:[n.jsx(L,{color:"darkRed"}),"Add Item"]})})]})};export{dt as N};
