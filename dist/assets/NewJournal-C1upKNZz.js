import{r as m,j as e,w as se,Y as ae,X as re,a as oe,u as v,Z as ne,L as le,x as ce,_ as C,T as ie,B as L,e as y}from"./index-A_edQTkL.js";const de=({index:i,account:b,accountOptions:N,isDropdownOpen:A,search:D,onAccountSelect:E,onSearchChange:R,onDropdownToggle:l,clearSearch:p})=>{const S=d=>{d.target instanceof Element&&!d.target.closest(".relative")&&(l(i,!1),p(i))};return m.useEffect(()=>(document.addEventListener("click",S),()=>{document.removeEventListener("click",S)}),[]),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap relative dropdown-container",children:[e.jsxs("div",{className:"flex items-center border rounded-md border-inputBorder ",onClick:()=>l(i,!A),children:[e.jsx("input",{type:"text",placeholder:"Select Account",value:b,readOnly:!0,className:"rounded-md cursor-pointer text-sm p-2 w-full   focus:outline-none"}),e.jsx("div",{className:"-ms-8",children:e.jsx(se,{color:"#818894"})})]}),A&&e.jsxs("div",{className:"absolute z-10 p-2 w-[102%] bg-white border border-tableBorder rounded-lg mt-1",children:[e.jsx(ae,{placeholder:"Search",value:D,onChange:d=>R(i,d.target.value)}),e.jsx("ul",{className:"overflow-y-auto text-start h-48",children:N==null?void 0:N.filter(d=>d.accountName.toLowerCase().includes(D.toLowerCase())).map(d=>e.jsx("li",{onClick:()=>E(i,d),className:"p-2 cursor-pointer border text-sm border-dropdownBorder text-textColor font-semibold mt-2 rounded-lg bg-CreamBg",children:d.accountName},d._id))})]})]})};function ue({color:i}){return e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M8 12H16M12 8V16M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z",stroke:i,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})}function pe({page:i}){const{id:b}=re(),N=oe(),{request:A}=v("post",5001),{request:D}=v("put",5001),{request:E}=v("get",5001),{request:R}=v("get",5001),{organization:l}=ne(),p=[{accountId:"",accountCode:"",accountName:"",debitAmount:0,creditAmount:0,description:"",contact:""},{accountId:"",accountCode:"",accountName:"",debitAmount:0,creditAmount:0,description:"",contact:""}],[S,d]=m.useState(null),[x,$]=m.useState({totalDebit:0,totalCredit:0,difference:0,differencesLabel:""}),[r,c]=m.useState({journel:"",date:"",reference:"",note:"",cashBasedJournal:!1,currency:"INR",transaction:p,totalDebitAmount:0,totalCreditAmount:0});console.log(r,"newJournalDatas");const G=["Account","Description","Debits","Credits","Actions"],[j,B]=m.useState(Array(p.length).fill(!1)),[T,_]=m.useState(Array(p.length).fill(!1)),[g,J]=m.useState(Array(p.length).fill("")),[I,P]=m.useState(Array(p.length).fill("")),U=()=>{const t={accountId:"",accountCode:"",accountName:"",debitAmount:0,creditAmount:0,description:"",contact:""};c({...r,transaction:[...r.transaction,t]}),B([...j,!1]),_([...T,!1]),J([...g,""]),P([...I,""])},q=t=>{t<2||(c({...r,transaction:r.transaction.filter((s,a)=>a!==t)}),B(j.filter((s,a)=>a!==t)),_(T.filter((s,a)=>a!==t)),J(g.filter((s,a)=>a!==t)),P(I.filter((s,a)=>a!==t)))},H=[{value:"INR",display:"INR - Indian Rupees"},{value:"USD",display:"USD - United States Dollar"},{value:"EUR",display:"EUR - Euro"},{value:"GBP",display:"GBP - British Pound Sterling"},{value:"JPY",display:"JPY - Japanese Yen"},{value:"AUD",display:"AUD - Australian Dollar"},{value:"CAD",display:"CAD - Canadian Dollar"},{value:"CHF",display:"CHF - Swiss Franc"},{value:"CNY",display:"CNY - Chinese Yuan"},{value:"NZD",display:"NZD - New Zealand Dollar"},{value:"SGD",display:"SGD - Singapore Dollar"},{value:"HKD",display:"HKD - Hong Kong Dollar"},{value:"KRW",display:"KRW - South Korean Won"},{value:"SEK",display:"SEK - Swedish Krona"},{value:"NOK",display:"NOK - Norwegian Krone"}],Y=async()=>{try{const t=`${y.Get_LAST_Journel_Prefix}`,{response:s,error:a}=await E(t);!a&&s&&(console.log("response",s),c({...r,journel:s==null?void 0:s.data}))}catch(t){console.error("Error fetching accounts:",t)}},W=async()=>{try{const t=`${y.Get_ALL_Acounts}`,{response:s,error:a}=await R(t);if(!a&&s)return d(s.data),console.log("All accounts",s),s.data}catch(t){console.error("Error fetching accounts:",t)}};m.useEffect(()=>{Y(),W()},[]),m.useEffect(()=>{if(!Array.isArray(r.transaction))return;const t=r.transaction.reduce((o,n)=>{const h=typeof n.debitAmount=="string"?parseFloat(n.debitAmount):typeof n.debitAmount=="number"?n.debitAmount:0;return o+(isNaN(h)?0:h)},0),s=r.transaction.reduce((o,n)=>{const h=typeof n.creditAmount=="string"?parseFloat(n.creditAmount):typeof n.creditAmount=="number"?n.creditAmount:0;return o+(isNaN(h)?0:h)},0),a=t-s;$({totalDebit:t,totalCredit:s,difference:a,differencesLabel:a<0?"(Debit)":"(Credit)"}),c({...r,totalCreditAmount:parseFloat(s.toFixed(2)),totalDebitAmount:parseFloat(t.toFixed(2))})},[r.transaction]);const Z=async()=>{const{journel:t,date:s,reference:a,note:o,currency:n,transaction:h,totalDebitAmount:ee,totalCreditAmount:te}=r;console.log(r);let u=[];if(t||u.push("Journal"),s||u.push("Date"),a||u.push("Reference"),o||u.push("Note"),n||u.push("Currency"),(ee===void 0||te===void 0)&&u.push("Total Debit and Credit Amounts"),x&&x.difference&&u.push("Ensure that the debit and credits are equal!"),h.length<2&&u.push("At least two transactions"),h.forEach((f,k)=>{f.accountId||u.push(`Transaction ${k+1}: Account ID`),f.debitAmount===void 0&&f.creditAmount===void 0&&u.push(`Transaction ${k+1}: Debit or Credit Amount`)}),u.length>0)C.error(`Please fill the following fields: ${u.join(", ")}`);else try{const f=i==="edit"?`${y.EDIT_JOURNAL}/${b}`:`${y.Add_NEW_Journel}`,K=await(i==="edit"?D:A)(f,r);console.log("api response",K);const{response:O,error:w}=K;!w&&O?(C.success(O.data.message),c({journel:"",date:"",reference:"",note:"",cashBasedJournal:!1,currency:"INR",transaction:p,totalDebitAmount:0,totalCreditAmount:0}),setTimeout(()=>{N("/accountant/manualjournal")},100)):(C.error(w==null?void 0:w.response.data.message),console.log("error",w))}catch(f){console.log("Error during API call",f)}},M=(t,s)=>{const a=[...r.transaction];a[t].accountName=s.accountName,a[t].accountId=s._id,a[t].accountCode=s.accountCode,c({...r,transaction:a}),B(j.map((o,n)=>n===t?!1:o))},V=(t,s)=>{const a=[...g];a[t]=s,J(a)},X=(t,s)=>{B(j.map((a,o)=>o===t?s:a))},Q=t=>{const s=[...g];s[t]="",J(s)},F=(t,s,a)=>{const o=[...r.transaction];if(s==="creditAmount"||s==="debitAmount")if(a==="")o[t][s]=0;else{const n=parseFloat(a);isNaN(n)?o[t][s]=0:o[t][s]=parseFloat(n.toFixed(2))}else o[t][s]=a;c({...r,transaction:o})},{request:z}=v("get",5001);return m.useEffect(()=>{(async()=>{if(i==="edit")try{const s=`${y.GET_ONE_JOURNAL}/${b}`,{response:a,error:o}=await z(s);!o&&a&&c(n=>({...n,...a.data,transaction:a.data.transaction||p}))}catch(s){console.log("Error in fetching",s)}})()},[i,b]),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(le,{to:"/accountant/manualjournal",children:e.jsx("div",{style:{borderRadius:"50%"},className:"w-[40px] h-[40px] flex items-center justify-center bg-white",children:e.jsx(ce,{})})}),e.jsx("p",{className:"text-textColor text-xl font-bold",children:"Create New Journal"})]}),e.jsxs("div",{className:"mt-5 p-3 pb-5 rounded-md bg-white",children:[e.jsxs("div",{className:"grid gap-5 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between w-full gap-9",children:[e.jsxs("div",{className:"w-[40%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Date"}),e.jsx("input",{type:"date",className:"mt-1 w-full border border-inputBorder rounded-md text-sm p-2",placeholder:"25/06/24",value:r.date,onChange:t=>c({...r,date:t.target.value})})]}),e.jsxs("div",{className:"w-[26%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Journal#"}),e.jsx("input",{disabled:!0,type:"text",className:"mt-1 w-full border border-inputBorder rounded-md text-sm p-2",placeholder:"001",value:r.journel,onChange:t=>c({...r,journel:t.target.value})})]}),e.jsxs("div",{className:"w-[40%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Reference#"}),e.jsx("input",{type:"text",className:"mt-1 w-full border border-inputBorder rounded-md text-sm p-2",placeholder:"Value",value:r.reference,onChange:t=>c({...r,reference:t.target.value})})]})]}),e.jsxs("div",{className:"flex items-center justify-between w-full gap-9",children:[e.jsxs("div",{className:"w-[72%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Notes"}),e.jsx("input",{type:"text",className:"mt-1 w-full border border-inputBorder rounded-md text-sm p-2",placeholder:"Value",value:r.note,onChange:t=>c({...r,note:t.target.value})})]}),e.jsxs("div",{className:"w-[26%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Journal Type"}),e.jsxs("div",{className:"flex items-center justify-start mt-3",children:[e.jsx("input",{type:"checkbox",className:"h-[16px] w-[16px]",checked:r.cashBasedJournal,onChange:t=>c({...r,cashBasedJournal:t.target.checked})}),e.jsx("label",{className:"text-sm font-medium text-textColor ms-3",children:"Cash based journal ?"})]})]}),e.jsxs("div",{className:"w-[50%]",children:[e.jsx("label",{className:"block text-sm text-textColor",children:"Currency"}),e.jsx("select",{className:"mt-1 w-full border border-inputBorder bg-white rounded-md text-sm p-2",value:r.currency,onChange:t=>c({...r,currency:t.target.value}),children:H.map(t=>e.jsx("option",{value:t.value,children:t.display}))})]})]})]}),e.jsx("div",{className:"-mt-2 p-4",children:e.jsx("div",{className:"border rounded-md border-tableBorder",children:e.jsxs("table",{className:"min-w-full bg-white rounded-md",children:[e.jsx("thead",{className:"text-[12px] text-center text-dropdownText",children:e.jsx("tr",{style:{backgroundColor:"#F9F7F0"},children:G.map((t,s)=>e.jsx("th",{className:"py-3 px-8 font-medium border-b border-tableBorder",children:t},s))})}),e.jsx("tbody",{className:"text-center text-dropdownText",children:r.transaction.map((t,s)=>e.jsxs("tr",{className:"border-b border-tableBorder",children:[e.jsx(de,{index:s,account:t.accountName,accountOptions:S,isDropdownOpen:j[s],search:g[s],onAccountSelect:M,onSearchChange:V,onDropdownToggle:X,clearSearch:Q}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("textarea",{className:"w-full border border-inputBorder rounded-md text-sm p-2 ",placeholder:"Description",style:{height:"2.5rem"},value:t.description,onChange:a=>F(s,"description",a.target.value)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("input",{type:"number",min:0,style:{margin:"0 !important",paddingRight:"0 !important"},className:"mt-1 w-[150px] border border-inputBorder rounded-md text-sm p-2",placeholder:"0.00",value:t.debitAmount||"",onChange:a=>{let o=parseFloat(a.target.value)||0;o<0&&(o=0),t.creditAmount?C.error("Clear credit before entering debit; both can’t be in one row."):F(s,"debitAmount",o)}})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("input",{type:"number",min:0,style:{margin:"0 !important",paddingRight:"0 !important"},className:"mt-1 w-[130px] border border-inputBorder rounded-md text-sm p-2",placeholder:"0.00",value:t.creditAmount||"",onChange:a=>{let o=parseFloat(a.target.value)||0;o<0&&(o=0),t.debitAmount?C.error("Clear debit before entering credit; both can’t be in one row."):F(s,"creditAmount",o)}})}),e.jsx("td",{onClick:()=>q(s),className:`px-6 py-6 items-center whitespace-nowrap text-sm flex justify-center cursor-pointer ${s<2?"cursor-not-allowed text-gray-400":""}`,children:e.jsx(ie,{color:s<2?"gray":"red"})})]},s))})]})})}),e.jsx("div",{className:"pl-5",children:e.jsxs("button",{onClick:U,className:"flex justify-center gap-1 ",children:[e.jsx(ue,{color:"#820000"})," ",e.jsx("span",{className:"text-sm text-maroon font-semibold",children:"Add New Row"})]})})]}),e.jsxs("div",{className:"mt-3 p-5 rounded-md bg-white w-[55%] ms-auto",children:[e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-4 flex flex-col gap-3",children:[e.jsx("p",{className:"text-[14px] text-[#4B5C79]",children:"Sub Total"}),e.jsx("span",{className:"text-xl font-bold text-textColor",children:"Total"})]}),e.jsxs("div",{className:"col-span-3 flex flex-col gap-3",children:[e.jsxs("h4",{className:"text-[14px] text-[#4B5C79]",children:[l==null?void 0:l.baseCurrency," ",x.totalDebit.toFixed(2)]}),e.jsxs("span",{className:"text-textColor font-bold text-xl",children:[l==null?void 0:l.baseCurrency," ",x.totalDebit.toFixed(2)]})]}),e.jsxs("div",{className:"col-span-3 flex flex-col w-[130px]  gap-3 me-5",children:[e.jsxs("h4",{className:"text-[14px] text-[#4B5C79] text-end",children:[l==null?void 0:l.baseCurrency," ",x.totalCredit.toFixed(2)]}),e.jsxs("span",{className:"text-textColor font-bold text-xl text-end",children:[l==null?void 0:l.baseCurrency," ",x.totalCredit.toFixed(2)]})]}),e.jsxs("div",{className:"col-span-2 flex flex-col gap-1 bg-[#FEF7F7] py-[4px] px-[14px]",children:[e.jsx("h4",{className:"text-[12px] text-[#820000]",children:"Difference"}),e.jsx("h2",{className:"text-[#820000] font-bold text-[18px]",children:Math.abs(x.difference).toFixed(2)}),e.jsx("h4",{className:"text-[12px] text-[#820000]",children:x.difference?x.differencesLabel:""})]})]}),e.jsx("hr",{className:"mt-3 border-t border-hr"}),e.jsx("br",{}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx(L,{variant:"secondary",size:"sm",children:"Cancel"}),e.jsx(L,{variant:"secondary",size:"sm",children:"Save as Draft"}),e.jsx(L,{onClick:Z,variant:"primary",size:"sm",children:"Save & Publish"})]})]})]})}export{pe as default};
