import{j as e,r as s,u as $,Z as $e,ay as be,B as V,P as Ue,M as Ve,w as Q,e as U,_ as X,aq as Ge,a as He,X as qe,L as Ze,x as Je,af as We}from"./index-A_edQTkL.js";import{O as Qe}from"./OCRNewInvoice-Dgrnbh-s.js";import{D as u}from"./DotIcon-DTVVVqGb.js";import{N as Xe}from"./NewUnit-D3n73ESX.js";import"./6-dMV7aCto.js";const ve=()=>e.jsx("div",{children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M13.3307 4L5.9974 11.3333L2.66406 8",stroke:"white","stroke-width":"2",strokeLinecap:"round","stroke-linejoin":"round"})})}),ge={_id:"",itemType:"goods",itemName:"",unit:"",taxPreference:"",taxExemptReason:"",sellingPrice:"",taxRate:"",purchaseDescription:""},Ke=()=>{const[w,_]=s.useState(!1),[i,h]=s.useState(ge),[p,y]=s.useState(null),C=s.useRef(null),[G,o]=s.useState([]),[E,z]=s.useState([]),{request:H}=$("get",5003),{request:k}=$("get",5004),{request:q}=$("post",5003),{organization:v}=$e(),{setOcrAddItem:L}=s.useContext(be),B=a=>{y(a===p?null:a)},T=a=>{C.current&&!C.current.contains(a.target)&&y(null)},I=async(a,x,f)=>{try{const{response:g,error:Z}=await f(a);!Z&&g?x(g.data):console.error(`Error fetching from ${a}:`,Z)}catch(g){console.error("Error fetching data:",g)}},O=(a,x)=>{let f=x;a==="unit"&&x.unitName&&(f=x.unitName),h(g=>({...g,[a]:f})),console.log(f,"updatedValue"),console.log(a,"key"),y(null)},r=()=>_(!0),c=()=>_(!1),l=a=>{const{name:x,value:f,type:g}=a.target;g==="number"&&parseFloat(f)<0||h(Z=>({...Z,[x]:g==="checkbox"?a.target.checked:f}))},N=async()=>{try{const a=`${U.ADD_ITEM}`,{response:x,error:f}=await q(a,i);!f&&x?(X.success(x.data.message),c(),L(g=>({...g,...i}))):X.error(f.response.data.message)}catch(a){X.success(`Something went wong ${a}`)}},A=()=>{h(ge),c()};return s.useEffect(()=>{const a=`${U.GET_ALL_UNIT}`,x=`${U.GET_ALL_TAX}`;I(x,z,k),I(a,o,H)},[]),s.useEffect(()=>{i.taxPreference==="Taxable"?h(a=>({...a,taxExemptReason:""})):h(a=>({...a,taxRate:""}))},[i.taxPreference]),s.useEffect(()=>(p!==null?document.addEventListener("mousedown",T):document.removeEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}),[p]),console.log(i,"itemsdata"),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(V,{variant:"primary",size:"sm",onClick:r,className:"px-[80%]",children:[e.jsx(Ue,{color:"white"}),e.jsx("p",{className:"text-sm font-medium",children:"Create"})]})}),e.jsx(Ve,{open:w,onClose:c,className:"w-[40%] ",children:e.jsxs("div",{className:"p-5 mt-3",children:[e.jsxs("div",{className:"mb-5 flex p-4 rounded-xl bg-CreamBg relative  ",children:[e.jsx("div",{className:"absolute top-0 -right-8 w-[178px] h-[89px]"}),e.jsx("div",{className:"relative z-10",children:e.jsx("h3",{className:"text-xl font-bold text-textColor",children:"Add New Item"})}),e.jsx("div",{className:"ms-auto text-3xl cursor-pointer relative z-10",onClick:c,children:"Ã—"})]}),e.jsxs("form",{className:"text-start space-y-3 overflow-y-scroll hide-scrollbar",children:[e.jsxs("div",{className:"flex justify-start items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-labelColor",htmlFor:"itemType",children:"Item Type"}),e.jsxs("div",{className:"flex items-center space-x-4 text-textColor text-sm",children:[e.jsxs("div",{className:"flex gap-2 justify-center items-center",children:[e.jsxs("div",{className:"grid place-items-center mt-1",onClick:()=>{h(a=>({...a,itemType:"goods"}))},children:[e.jsx("input",{id:"goods",type:"radio",name:"itemType",value:"goods",className:`col-start-1 row-start-1 appearance-none shrink-0 w-5 h-5 rounded-full border ${i.itemType==="goods"?"border-8 border-[#97998E]":"border-1 border-[#97998E]"}`,checked:i.itemType==="goods",onChange:l}),e.jsx("div",{className:`col-start-1 row-start-1 w-2 h-2 rounded-full ${i.itemType==="goods"?"bg-neutral-50":"bg-transparent"}`})]}),e.jsx("label",{htmlFor:"goods",className:"text-start font-medium mt-1",children:"Goods"})]}),e.jsxs("div",{className:"flex gap-2 justify-center items-center",children:[e.jsxs("div",{className:"grid place-items-center mt-1",onClick:()=>{i(a=>({...a,itemType:"service"}))},children:[e.jsx("input",{id:"service",type:"radio",name:"itemType",value:"service",className:`col-start-1 row-start-1 appearance-none shrink-0 w-5 h-5 rounded-full border ${i.itemType==="service"?"border-8 border-[#97998E]":"border-1 border-[#97998E]"}`,checked:i.itemType==="service",onChange:l}),e.jsx("div",{className:`col-start-1 row-start-1 w-2 h-2 rounded-full ${i.itemType==="service"?"bg-neutral-50":"bg-transparent"}`})]}),e.jsx("label",{htmlFor:"service",className:"text-start font-medium mt-1",children:"Service"})]})]})]}),e.jsx("div",{className:"grid grid-cols-12 gap-4 ms-5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-600 text-sm mb-0.5",htmlFor:"itemName",children:"Name"}),e.jsx("input",{className:"pl-3 text-sm w-[100%] mt-0.5 rounded-md text-start bg-white border border-inputBorder h-10 leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Enter Name",name:"itemName",value:i.itemName,onChange:l})]}),e.jsxs("div",{className:"relative col-span-3 mt-3",children:[e.jsx("label",{htmlFor:"unit-input",className:"text-slate-600 flex items-center gap-2",children:"Unit"}),e.jsxs("div",{className:"relative w-full ",children:[e.jsx("input",{id:"unit-input",type:"text",value:i.unit,readOnly:!0,className:"cursor-pointer appearance-none mt-0.5 w-full items-center flex text-zinc-400 bg-white border border-inputBorder text-sm h-10 pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Select Unit",onClick:()=>B("unit")}),e.jsx("div",{className:"cursor-pointer pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(Q,{color:"gray"})})]}),p==="unit"&&e.jsxs("div",{ref:C,className:"absolute w-[100%] z-10 bg-white rounded-md mt-1 p-2 space-y-1 border border-inputBorder",children:[G&&G.map((a,x)=>e.jsx("div",{onClick:()=>O("unit",a),className:"flex p-2 w-[100%]  hover:bg-gray-100 cursor-pointer border rounded-lg bg-lightPink border-slate-300 text-sm text-textColor",children:a.unitName},x)),e.jsx(Xe,{page:"item"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"taxPreference",className:"text-slate-600 text-sm flex items-center gap-2",children:"Tax Preference"}),e.jsxs("select",{className:"block appearance-none w-full mt-0.5 text-zinc-400 bg-white border border-inputBorder text-sm h-10 pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",name:"taxPreference",value:i.taxPreference,onChange:l,children:[e.jsx("option",{value:"",disabled:!0,hidden:!0,children:"Select Tax Preference"}),e.jsx("option",{value:"Taxable",children:"Taxable"}),e.jsx("option",{value:"Non-taxable",children:"Non-Taxable"})]}),e.jsx("div",{className:"cursor-pointer pointer-events-none absolute inset-y-0 mt-5 right-0 flex items-center px-2 text-gray-700",children:e.jsx(Q,{color:"gray"})})]}),i.taxPreference==="Taxable"&&e.jsxs("div",{className:"relative mt-4",children:[e.jsx("label",{htmlFor:"taxRate",className:"text-slate-600 text-sm flex items-center gap-2",children:"Tax Rate"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{id:"taxRate-input",type:"text",value:i.taxRate||"",readOnly:!0,name:"taxRate",className:"cursor-pointer appearance-none w-full items-center flex text-zinc-400 bg-white border border-inputBorder text-sm h-10 pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Select Tax Rate",onClick:()=>B("taxRate")}),e.jsx("div",{className:"cursor-pointer pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(Q,{color:"gray"})})]}),p==="taxRate"&&e.jsx("div",{ref:C,className:"absolute w-[100%] z-10 bg-white rounded-md mt-1 p-2 space-y-1 border border-inputBorder",children:E.gstTaxRate&&E.gstTaxRate.map((a,x)=>e.jsx("div",{onClick:()=>O("taxRate",a.taxName),className:"flex p-2 w-[100%]  hover:bg-gray-100 cursor-pointer border rounded-lg bg-lightPink border-slate-300 text-sm text-textColor",children:a.taxName},x))})]}),i.taxPreference==="Non-taxable"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-600 text-sm mb-0.5",htmlFor:"itemName",children:"Exemption Reason"}),e.jsx("input",{className:"pl-3 text-sm w-[100%] mt-0.5 rounded-md text-start bg-white border border-inputBorder h-10 leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Exemption Reason",name:"taxExemptReason",value:i.taxExemptReason,onChange:l})]}),e.jsxs("div",{className:"relative  mt-0.5",children:[e.jsx("label",{className:"text-slate-600 flex text-sm gap-2",htmlFor:"sellingPrice",children:"Selling Price"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-16 text-sm mt-0.5 rounded-l-md text-start bg-white text-zinc-400 border border-inputBorder h-10 items-center justify-center flex",children:v==null?void 0:v.baseCurrency}),e.jsx("input",{type:"number",min:0,className:"pl-3 text-sm w-[100%] mt-0.5   rounded-r-md text-start bg-white border border-inputBorder h-10 leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Enter Price",name:"sellingPrice",value:i.sellingPrice,onChange:l})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-600 text-sm mb-0.5",htmlFor:"itemName",children:"Description"}),e.jsx("input",{className:"pl-3 text-sm w-[100%] mt-0.5 rounded-md text-start bg-white border border-inputBorder h-10 leading-tight focus:outline-none focus:bg-white focus:border-darkRed",placeholder:"Enter Description",name:"purchaseDescription",value:i.purchaseDescription,onChange:l})]})]}),e.jsxs("div",{className:"justify-end me-5 flex gap-4 p-2",children:[e.jsx(V,{variant:"secondary",size:"sm",className:"text-sm pl-8 pr-8",onClick:A,children:"Cancel"}),e.jsx(V,{onClick:N,variant:"primary",size:"sm",className:"text-sm pl-8 pr-8",children:"Save"})]})]})})]})};function Ye({items:w=[],invoice:_,setInvoice:i,allItems:h}){const p=["Sl.No","Product Name","HSN/SAC","Quantity","Rate","Gross","Discount","Net Amount","Tax %","Tax Amount","Total","Batch Number","Expiry Date"],[y,C]=s.useState(null),[G,o]=s.useState(null),E=s.useRef(null),[z,H]=s.useState(null),[k,q]=s.useState(null),[v,L]=s.useState(null),B=r=>{o(c=>c===r?null:r)},T=r=>{var l,N;const c=(N=(l=w[r])==null?void 0:l.itemName)==null?void 0:N.toLowerCase().trim();h==null||h.some(A=>{var a;return((a=A.itemName)==null?void 0:a.toLowerCase().trim())===c}),q([]),L(null),C(A=>A===r?null:r)},I=()=>{var N;if(!z){console.error("No invoice item available.");return}if(!h||h.length===0){console.error("No item data available.");return}const r=(N=z.itemName)==null?void 0:N.toLowerCase().trim();if(!r)return;const c=r.replace(/\s+/g,"").toLowerCase(),l=h.filter(A=>{const a=A.itemName.replace(/\s+/g,"").toLowerCase(),x=a.includes(c),f=a.substring(0,2),g=c.substring(0,2);return x||f===g});l.length===0?console.log(`No matching Item found for '${r}'.`):q(l)},O=r=>{if(!v){console.error("No item selected.");return}const c=_.invoice.items.map((l,N)=>N===r?{...l,itemName:v.itemName}:l);i==null||i(l=>({...l,invoice:{...l.invoice,items:c}})),C(null),o(null)};return s.useEffect(()=>{I()},[h,w,y]),s.useEffect(()=>{const r=c=>{E.current&&!E.current.contains(c.target)&&C(null)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),e.jsx("div",{className:"overflow-x-auto hide-scrollbar h-[300px]",children:e.jsxs("table",{ref:E,className:"min-w-full border-collapse text-xs text-textColor h-[100px]",children:[e.jsx("thead",{children:e.jsx("tr",{children:p.map((r,c)=>e.jsx("th",{className:"border font-semibold text-xs min-w-min border-[#F4F4F4] py-2 px-5 text-textColor bg-[#f5f9fc] whitespace-nowrap",children:r},c))})}),e.jsx("tbody",{children:w.map((r,c)=>e.jsxs("tr",{className:"hover:bg-gray-50 text-center",children:[e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:c+1}),e.jsx("td",{onClick:()=>{T(c),H(r)},className:`border px-4 py-3 whitespace-nowrap cursor-pointer relative ${y===c?"border-[#F4F4F4] bg-lightPink":"border-[#F4F4F4]"}`,children:e.jsxs("div",{children:[r.itemName,y===c&&e.jsxs("div",{className:"absolute z-10  -ms-5 bg-white rounded-md mt-3.5 p-2 space-y-1 max-h-72 overflow-y-auto hide-scrollbar",style:{boxShadow:"1px 1px 5px 0.5px",width:"350px"},children:[e.jsxs("div",{className:"flex gap-3 mb-4 items-center",children:[e.jsx(u,{color:"#DD2020",size:15}),e.jsx("p",{className:"text-textColor font-bold text-sm",children:"Line Item"})]}),e.jsx("div",{className:"h-9 rounded-md border border-neutral-200 my-5 flex",onClick:l=>{l.stopPropagation()},children:e.jsxs("div",{className:"flex w-full",onClick:()=>B("dropdown1"),children:[e.jsx("div",{className:"flex items-center px-3 text-loremcolor text-sm",children:v!=null&&v.itemName?v.itemName:" Select Product"}),e.jsx("div",{className:"items-center justify-end ml-auto flex pe-2 ",children:e.jsx(Q,{color:"gray"})})]})}),G==="dropdown1"&&e.jsx("div",{className:"space-y-1",children:(k==null?void 0:k.length)>0?k.map(l=>e.jsx("div",{className:"flex items-center px-3 text-loremcolor text-sm h-9 bg-[#f2f2f2]",onClick:N=>{N.stopPropagation(),L(l),B("dropdown1")},children:l.itemName},l._id)):e.jsx("div",{className:"flex items-center px-3 text-loremcolor  h-9 bg-[#f2f2f2]",children:e.jsx("p",{className:"text-darkRed",children:"No Matching Items in the Inventory..!"})})}),e.jsxs("div",{className:"flex justify-end py-3 gap-2",children:[e.jsx(V,{variant:"secondary",size:"sm",children:"Cancel"}),e.jsxs("button",{className:"bg-[#32A370] px-2 rounded-md text-white font-semibold flex items-center justify-center gap-1",onClick:()=>{O(y),T(c)},children:[e.jsx(ve,{}),"Confirm"]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("p",{className:"font-bold",children:"OR"})}),e.jsx("div",{className:"w-full flex items-center justify-center",onClick:l=>l.stopPropagation(),children:e.jsx(Ke,{})})]})]})}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.hsn_sac||"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemQuantity}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemCostPrice?r.itemCostPrice:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.gross?r.gross:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemDiscount?r.itemDiscount:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.net_amount?r.net_amount:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemTax?r.itemTax:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemCgstAmount?r.itemCgstAmount:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.itemAmount?r.itemAmount:"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.batch_no||"-"}),e.jsx("td",{className:"border border-[#F4F4F4] px-4 py-3 whitespace-nowrap",children:r.expiry_date||"-"})]},r.id))})]})})}const et=({})=>e.jsx("div",{children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 19L13 13M19 19V14.2M19 19H14.2M1 14.2V19M1 19H5.8M1 19L7 13M19 5.8V1M19 1H14.2M19 1L13 7M1 5.8V1M1 1H5.8M1 1L7 7",stroke:"#4B5C79","stroke-width":"2",strokeLinecap:"round","stroke-linejoin":"round"})})}),tt=()=>e.jsx("div",{children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18.9999 18.9999L14.6499 14.6499M6 9H12M17 9C17 13.4183 13.4183 17 9 17C4.58172 17 1 13.4183 1 9C1 4.58172 4.58172 1 9 1C13.4183 1 17 4.58172 17 9Z",stroke:"#4B5C79","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})})}),st=()=>e.jsx("div",{children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18.9999 18.9999L14.6499 14.6499M9 6V12M6 9H12M17 9C17 13.4183 13.4183 17 9 17C4.58172 17 1 13.4183 1 9C1 4.58172 4.58172 1 9 1C13.4183 1 17 4.58172 17 9Z",stroke:"#4B5C79","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})})}),je=w=>{const _=s.useRef();return s.useEffect(()=>{_.current=w}),_.current},it=()=>{var de,me,xe,pe,ue,he;const[w,_]=s.useState(null),[i,h]=s.useState(null),[p,y]=s.useState(1),[C,G]=s.useState(!1),[o,E]=s.useState([]),[z,H]=s.useState([]),[k,q]=s.useState([]),[v,L]=s.useState([]),[B,T]=s.useState(!1),[I,O]=s.useState(null),[r,c]=s.useState(!0),[l,N]=s.useState([]),[A,a]=s.useState([]),[x,f]=s.useState(1),{supplierResponse:g}=s.useContext(Ge),Z=He(),{ocrAddItem:Ne}=s.useContext(be),[S,re]=s.useState({account_no:"",bank_name:"",branch_name:"",ifsc_code:""}),[R,ee]=s.useState({dueDate:"",billNumber:"",billDate:"",supplierAddress:"",supplierDisplayName:"",supplierPhone:"",supplier_id:""}),[D,ae]=s.useState({additional_notes:"",grand_total:"",sgst:"",cgst:"",igst:"",payment_terms:""}),{request:we}=$("get",5e3),{request:ye}=$("get",5009),{request:Ce}=$("get",5003),{request:ke}=$("put",5e3),te=10,P=Math.ceil(z.length/te),ne=(p-1)*te,Se=ne+te,j=z.slice(ne,Se),{id:le}=qe(),De=je(l),Fe=je(j),Ee=()=>{f(t=>Math.min(t+.1,2))},_e=()=>{f(t=>Math.max(t-.1,.5))},Ie=()=>{const t=[];if(P<=5)for(let n=1;n<=P;n++)t.push(n);else p<=3?t.push(1,2,3,4,"..."):p>=P-2?t.push("...",P-3,P-2,P-1,P):t.push("...",p-1,p+1,p,p+2,"...");return t},oe=t=>{h(n=>n===t?null:t)},J=t=>{_(n=>n===t?null:t)},K=s.useRef(null),se=t=>{K.current&&!K.current.contains(t.target)&&_(null)},Ae=()=>{G(!C)},Re=async()=>{var t,n,d;T(!0);try{const m=`${U.GET_A_OCR_INVOICE}/${le}`,{response:F,error:Y}=await we(m);!Y&&F&&((t=F.data[0])==null||delete t.status,E(F.data[0]),H((d=(n=F.data[0])==null?void 0:n.invoice)==null?void 0:d.items),re(F.data[0].invoice.bank_details),ee(F.data[0].invoice.header),ae(F.data[0].invoice.footer))}catch(m){console.error("Error in fetching invoice data",m)}finally{T(!1)}},ie=async(t,n,d)=>{try{const{response:m,error:F}=await d(t);!F&&m&&n(m.data)}catch(m){console.error("Error fetching data:",m)}},ce=()=>{var Y,fe;if(!o||o.length===0){console.error("No invoice data available.");return}if(!k||k.length===0){console.error("No suppliers data available.");return}const t=(fe=(Y=o==null?void 0:o.invoice)==null?void 0:Y.header)==null?void 0:fe.supplier_name;if(!t){console.error("No supplier name found in the invoice.");return}const n=k.filter(M=>M.supplierDisplayName===t),d=t.replace(/\s+/g,"").toLowerCase(),m=k.filter(M=>{const W=M.supplierDisplayName.replace(/\s+/g,"").toLowerCase(),ze=W.includes(d),Be=W.substring(0,5),Oe=d.substring(0,5);return ze||Be===Oe}),F=Array.from(new Map([...n,...m].map(M=>[M._id,M])).values());F.length>0?(c(n.length>0),L(F)):(c(!1),L([])),n.length>0&&E(M=>{var W;return{...M,invoice:{...M.invoice,header:{...M.invoice.header,supplier_id:(W=n[0])==null?void 0:W._id}}}})},Me=()=>{const t=j.map(n=>{const d=l.some(m=>m.itemName===n.itemName);return{item_id:n.item_id,isMatch:d}});a(t)},b=(t,n,d)=>{switch(t){case"bankDetails":re(m=>({...m,[n]:d}));break;case"header":ee(m=>({...m,[n]:d}));break;case"footer":ae(m=>({...m,[n]:d}));break}},Te=async()=>{try{const t=`${U.UPDATE_OCR_DATA}/${le}`,{response:n,error:d}=await ke(t,o);!d&&n?(X.success(n.data.message),Z("/purchase/bills/invoice")):X.error(d.response.data.error)}catch{}};s.useEffect(()=>{const{items:t}=(o==null?void 0:o.invoice)||{};H(t||[])},[o==null?void 0:o.invoice]),s.useEffect(()=>{E(t=>({...t,invoice:{...t.invoice,bank_details:S,header:R,footer:D}}))},[S,R,D]);const Le=()=>{if(!I){console.error("No supplier selected.");return}L([]),J("supplierName"),ee(t=>({...t,supplier_name:I.supplierDisplayName,supplier_id:I._id})),ce()};s.useEffect(()=>{ce()},[k,(me=(de=o==null?void 0:o.invoice)==null?void 0:de.header)==null?void 0:me.supplier_name]),s.useEffect(()=>{(JSON.stringify(De)!==JSON.stringify(l)||JSON.stringify(Fe)!==JSON.stringify(j))&&Me()},[l,j]),s.useEffect(()=>{const t=`${U.GET_ALL_ITEM}`,n=`${U.GET_ALL_SUPPLIER}`;ie(n,q,ye),ie(t,N,Ce),Re()},[g,Ne]),s.useEffect(()=>(w!==null?document.addEventListener("mousedown",se):document.removeEventListener("mousedown",se),()=>{document.removeEventListener("mousedown",se)}),[w]),console.log(o,"invoice");const Pe=(pe=(xe=o==null?void 0:o.image)==null?void 0:xe.file)==null?void 0:pe.startsWith("data:application/pdf");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-5 my-4 flex items-center  gap-x-4",children:[e.jsx(Ze,{to:"/purchase/bills/invoice",children:e.jsx("div",{className:"flex justify-center items-center h-11 w-11 bg-tertiary_main rounded-full",children:e.jsx(Je,{})})}),e.jsx("div",{children:e.jsx("h3",{className:"font-bold text-2xl text-textColor",children:"All Invoice"})}),e.jsx("div",{className:"ml-auto gap-3 flex items-center",children:e.jsx(Qe,{})})]}),e.jsxs("div",{className:"bg-white rounded-lg grid grid-cols-12 gap-4 mx-5 p-5 main-div ",children:[e.jsxs("div",{className:`rounded-lg relative ${C?"col-span-12":"col-span-7"}`,children:[e.jsxs("div",{className:"h-10 header-div bg-[#E5E5E5] rounded-t-lg text-xs font-bold text-[#4B5C79] flex items-center px-4 z-10 relative",children:[e.jsx("p",{children:"INV-001.png"}),e.jsxs("div",{className:"ml-auto flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:Ee,children:e.jsx(st,{})}),e.jsx("button",{onClick:_e,children:e.jsx(tt,{})}),e.jsx("button",{className:"flex justify-end ms-5",onClick:Ae,children:e.jsx(et,{})})]})]}),e.jsxs("div",{className:"flex items-center justify-center h-[760px] py-2 bg-[#F3F3F3] relative overflow-auto hide-scrollbar",children:[B?e.jsx("div",{className:"loader"}):Pe?e.jsx("iframe",{src:(ue=o==null?void 0:o.image)==null?void 0:ue.file,width:"100%",height:"100%",style:{border:"none",transform:`scale(${x})`,transformOrigin:"top center"},title:"PDF Viewer"}):e.jsx("img",{className:"min-w-[65%]",src:(he=o==null?void 0:o.image)==null?void 0:he.file,alt:"Uploaded Content",style:{transform:`scale(${x})`}}),w==="items"&&e.jsxs("div",{ref:K,className:"absolute z-10 w-[100%] bg-white shadow rounded-md items-baseline p-2 space-y-1 max-h-96 overflow-y-auto hide-scrollbar",style:{bottom:"10px",left:"0"},children:[e.jsxs("div",{className:"flex gap-3 p-2 items-center font-semibold relative",children:[e.jsx(u,{color:"#DD2020",size:10}),e.jsx("p",{className:"text-textColor w-[20%] text-sm",children:"Line Items"})]}),e.jsx(Ye,{allItems:l,items:j,invoice:o,setInvoice:E})]})]})]}),!C&&e.jsxs("div",{className:"col-span-5",children:[e.jsx("div",{className:"h-10 bg-[#E5E5E5] rounded-t-lg text-xs font-bold text-[#4B5C79] flex items-center px-4 relative",children:e.jsx("p",{children:"Fields"})}),e.jsxs("div",{className:"bg-[#F3F3F3] p-5 text-xs h-[710px] overflow-x-scroll hide-scrollbar",children:[e.jsx("div",{className:"border-b-[1px] border-[#c5c6c7] text-sm pb-2 mb-4 text-textColor font-semibold ",children:"Supplier Details"}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold relative",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Invoice Number"}),e.jsx("input",{type:"text",className:"invoice-input",name:"invoice_no",value:R==null?void 0:R.billNumber,placeholder:"Invoice",onChange:t=>b("header",t.target.name,t.target.value)})]}),e.jsxs("div",{className:`flex gap-5 p-2 items-center font-semibold ${r?"":"hover:bg-[#f5dddd]"}`,onClick:()=>J("supplierName"),children:[e.jsx(u,{color:r?"#32A370":"#DD2020",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Supplier Name"}),e.jsx("p",{className:` font-semibold ${r?"text-[#32A370]":"text-[#DD2020]"}`,children:e.jsx("span",{children:R.supplierDisplayName})})]}),w==="supplierName"&&e.jsxs("div",{ref:K,className:"absolute z-10 w-[70%] bg-white shadow rounded-md mt-1 p-2  space-y-1 max-h-72 overflow-y-auto hide-scrollbar",children:[e.jsxs("div",{className:"flex gap-3 mb-4 items-center",children:[e.jsx(u,{color:"#DD2020",size:15}),e.jsxs("p",{className:"text-textColor font-bold text-sm",children:[" ","Supplier Name"]})]}),e.jsxs("div",{className:"h-9 rounded-md border border-neutral-200 my-5 flex",onClick:()=>oe("dropdown1"),children:[e.jsx("div",{className:"flex items-center px-3 text-loremcolor text-sm",children:I?I.supplierDisplayName:"Select Supplier"}),e.jsx("div",{className:"items-center justify-end ml-auto flex pe-2",children:e.jsx(Q,{color:"gray"})})]}),i==="dropdown1"&&e.jsx(e.Fragment,{children:v.length>0?v.map(t=>e.jsx("div",{className:"flex items-center px-3 text-loremcolor text-sm h-9 bg-[#f2f2f2] cursor-pointer",onClick:()=>{O(t),oe("dropDown1")},children:t==null?void 0:t.supplierDisplayName},t==null?void 0:t.id)):e.jsx("div",{className:"flex items-center px-3 text-loremcolor text-sm h-9 bg-[#f2f2f2] cursor-pointer",children:e.jsx("p",{className:"text-darkRed",children:"No Similar suppliers found..!"})})}),e.jsxs("div",{className:"flex justify-end py-3 gap-2",children:[e.jsx(V,{variant:"secondary",size:"sm",onClick:()=>{J("supplierName"),O(null)},children:"Cancel"}),e.jsxs("button",{className:"bg-[#32A370] px-2 rounded-md text-white font-semibold flex items-center justify-center gap-1",onClick:Le,children:[e.jsx(ve,{}),"Confirm"]})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[" ",e.jsx("p",{className:"font-bold",children:"OR"})]}),e.jsx("div",{className:"w-full flex items-center justify-center cursor-pointer ",children:e.jsx(We,{page:"ocr"})})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Supplier Address"}),e.jsx("input",{type:"text",className:"invoice-input w-[50%]",value:R.supplierAddress,placeholder:"Invoice",onChange:t=>b("header",t.target.name,t.target.value),name:"supplier_address"})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Supplier Phone"}),e.jsx("input",{name:"supplier_phone",type:"text",className:"invoice-input",value:R.supplierPhone,placeholder:"Supplier Phone",onChange:t=>b("header",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Invoice Date"}),e.jsx("input",{type:"text",name:"invoice_date",className:"invoice-input",value:R.billDate,placeholder:"Invoice Date",onChange:t=>b("header",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Due Date"}),e.jsx("input",{type:"text",name:"due_date",className:"invoice-input",value:R.dueDate,placeholder:"Due Date",onChange:t=>b("header",t.target.name,t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"border-b-[0.5px] border-[#c5c6c7] text-sm pb-2 mb-4 text-textColor font-semibold mt-5",children:"Line Items"}),e.jsxs("div",{className:`mt-2 grid ${(j==null?void 0:j.length)>5?"grid-cols-2 gap-4":"grid-cols-1 gap-2"}`,children:[e.jsx("div",{className:"space-y-2",children:j==null?void 0:j.slice(0,5).map(t=>{const n=A.find(m=>m.item_id===t.item_id),d=(n==null?void 0:n.isMatch)??!1;return e.jsxs("div",{onClick:()=>J("items"),className:"flex items-center gap-4 font-semibold p-2 max-w-full",children:[e.jsx(u,{color:d?"#32A370":"#DD2020",size:10}),e.jsx("p",{className:"text-textColor whitespace-nowrap flex-shrink-0",children:"Line Item"}),e.jsx("p",{className:`truncate ${d?"text-[#32A370]":"text-[#DD2020]"}`,title:t.itemName,style:{maxWidth:"calc(100% - 150px)"},children:t.itemName})]},t.item_id)})}),e.jsx("div",{className:"space-y-2",children:j==null?void 0:j.slice(5,10).map(t=>{const n=A.find(m=>m.item_id===t.item_id),d=(n==null?void 0:n.isMatch)??!1;return e.jsxs("div",{onClick:()=>J("items"),className:"flex items-center gap-4 font-semibold p-2 max-w-full",children:[e.jsx(u,{color:d?"#32A370":"#DD2020",size:10}),e.jsx("p",{className:"text-textColor whitespace-nowrap flex-shrink-0",children:"Line Item"}),e.jsx("p",{className:`truncate ${d?"text-[#32A370]":"text-[#DD2020]"}`,title:t.itemName,style:{maxWidth:"calc(100% - 150px)"},children:t.itemName})]},t.item_id)})})]}),j.length>10&&e.jsxs("div",{className:"flex gap-1 mt-4 justify-end",children:[Ie().map((t,n)=>e.jsxs("p",{onClick:()=>typeof t=="number"&&y(t),className:`p-1 font-bold rounded-md ${p===t?"bg-darkRed text-white":"bg-gray-200 text-darkRed cursor-pointer hover:bg-darkRed hover:text-white"}`,children:["[",t,"]"]},n)),e.jsx("p",{onClick:()=>p>1&&y(p-1),className:"p-1 font-bold text-darkRed cursor-pointer hover:bg-darkRed hover:text-white rounded-md",children:"[Previous]"}),e.jsx("p",{onClick:()=>p<P&&y(p+1),className:"p-1 font-bold text-darkRed cursor-pointer hover:bg-darkRed hover:text-white rounded-md",children:"[Next]"})]})]}),e.jsx("div",{className:"border-b-[1px] border-[#c5c6c7] text-sm pb-2 mb-4 text-textColor font-semibold mt-5",children:"Transaction Details"}),e.jsxs("div",{className:"space-y- mt-2 w-full",children:[Number(D.sgst)>0&&Number(D.cgst)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"CGST"}),e.jsx("input",{type:"text",name:"cgst",className:"invoice-input",value:D==null?void 0:D.cgst,placeholder:"Invoice",onChange:t=>b("footer",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold w-full",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"SGST"}),e.jsx("input",{type:"text",name:"sgst",className:"invoice-input",value:D.sgst,placeholder:"Invoice",onChange:t=>b("footer",t.target.name,t.target.value)})]})]}),Number(D.igst)>0&&e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold w-full",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"IGST"}),e.jsx("input",{type:"text",name:"igst",className:"invoice-input",value:D.igst,placeholder:"Invoice",onChange:t=>b("footer",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:" Total Amount"}),e.jsx("input",{type:"text",className:"invoice-input ",value:D.grand_total,placeholder:"Total Amount",name:"grand_total",onChange:t=>b("footer",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2  justify-start font-semibold ",children:[e.jsxs("div",{className:"mt-1",children:[" ",e.jsx(u,{color:"#32A370",size:10})]}),e.jsx("p",{className:"text-textColor w-[20%]top-0 ",children:"Additional Notes"}),e.jsx("textarea",{name:"additional_notes",className:"invoice-input ",value:D.additional_notes,placeholder:"Additional Notes",onChange:t=>b("footer",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold ",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Bank Name"}),e.jsx("input",{name:"bank_name",type:"text",className:"invoice-input",value:S==null?void 0:S.bank_name,placeholder:"Bank  Name",onChange:t=>b("bankDetails",t.target.name,t.target.value)})]}),e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Account No."}),e.jsx("input",{name:"account_no",type:"text",className:"invoice-input",value:S==null?void 0:S.account_no,placeholder:"Bank Account No",onChange:t=>b("bankDetails",t.target.name,t.target.value)})]})," ",e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"Branch Name"}),e.jsx("input",{type:"text",name:"branch_name",className:"invoice-input",value:S==null?void 0:S.branch_name,placeholder:"Branch Name",onChange:t=>b("bankDetails",t.target.name,t.target.value)})]})," ",e.jsxs("div",{className:"flex gap-5 p-2 items-center font-semibold",children:[e.jsx(u,{color:"#32A370",size:10}),e.jsx("p",{className:"text-textColor w-[20%]",children:"IFSC Code"}),e.jsx("input",{name:"ifsc_code",type:"text",className:"invoice-input",value:S.ifsc_code,placeholder:"IFSC Code",onChange:t=>b("bankDetails",t.target.name,t.target.value)})]})]})]}),e.jsxs("div",{className:"py-2 bg-[#E5E5E5] rounded-b-lg text-xs text-[#4B5C79] flex items-center justify-end px-4 gap-2",children:[e.jsx(V,{className:"px-4 py-2 ",variant:"secondary",size:"sm",children:"Cancel"}),e.jsx(V,{className:"px-4 py-2",variant:"primary",size:"sm",onClick:Te,children:"Confirm Document"})]})]})]})]})};export{it as default};
