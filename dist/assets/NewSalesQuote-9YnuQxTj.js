import{r,u as f,a as oe,X as ce,j as e,L as ie,x as de,w as T,g as ue,a9 as xe,B as z,e as m,_ as b}from"./index-A_edQTkL.js";import{N as me}from"./NewCustomerModal-CBewSJCy.js";import{N as pe}from"./NewSalesQuoteTable-D8MQ_3z3.js";const G={customerId:"",customerDisplayName:"",placeOfSupply:"",reference:"",salesQuoteDate:"",expiryDate:"",subject:"",taxPreference:"Taxable",salesQuotes:"",items:[{itemId:"",itemName:"",quantity:"",sellingPrice:"",taxPreference:"",taxGroup:"",cgst:"",sgst:"",igst:"",cgstAmount:"",sgstAmount:"",igstAmount:"",vatAmount:"",itemTotalTax:"",discountType:"",discountAmount:"",amount:"",itemAmount:"",salesAccountId:""}],totalItemDiscount:"",subtotalTotal:"",note:"",tc:"",totalDiscount:"",discountTransactionType:"Percentage",discountTransactionAmount:"",transactionDiscount:"",subTotal:"",totalItem:"",cgst:"",sgst:"",igst:"",vat:"",totalTax:"",totalAmount:""},Ne=({page:j})=>{const[S,$]=r.useState(""),[N,w]=r.useState(null),C=r.useRef(null),[i,U]=r.useState([]),[E,R]=r.useState([]),[q,M]=r.useState([]),[g,O]=r.useState([]),[p,F]=r.useState(""),[V,X]=r.useState(""),[I,P]=r.useState(!1),{request:Y}=f("get",5004),{request:H}=f("get",5004),{request:_}=f("get",5002),{request:Z}=f("get",5007),[s,d]=r.useState(G),J=oe(),k=()=>{J(-1),d(G)},v=async(t,n,a)=>{try{const{response:c,error:l}=await a(t);!l&&c&&n(c.data)}catch(c){console.error("Error fetching data:",c)}},K=t=>{w(t===N?null:t);const n=`${m.GET_ALL_CUSTOMER}`;v(n,O,_)},D=t=>{C.current&&!C.current.contains(t.target)&&w(null)},W=async()=>{try{const t=`${m.GET_COUNTRY_DATA}`,{response:n,error:a}=await H(t);!a&&n&&M(n.data[0].countries)}catch(t){console.log("Error in fetching Country",t)}},Q=async()=>{try{const t=`${m.GET_LAST_SALES_QUOTE_PREFIX}`,{response:n,error:a}=await Z(t);!a&&n?X(n.data):console.log(a)}catch(t){console.log("Error in fetching Purchase Order Prefix",t)}},ee=()=>{const{totalItemDiscount:t,subtotalTotal:n,totalTax:a}=s;return(Number(n)+Number(a)-Number(t)).toFixed(2)};r.useEffect(()=>{const t=ee(),{discountTransactionType:n,discountTransactionAmount:a="0",transactionDiscount:c="0"}=s,l=n==="Percentage"?Number(a)/100*Number(t):Number(a),x=Math.round(l*100)/100,o=Math.round((Number(t)-x)*100)/100;(Number(c)!==x||Number(s.totalAmount)!==o)&&d(h=>({...h,transactionDiscount:x.toFixed(2),totalAmount:o.toFixed(2)}))},[s.discountTransactionAmount,s.discountTransactionType,s.subtotalTotal,s.totalTax,s.totalItemDiscount]);const se=()=>{if(i.organizationCountry){const t=q.find(n=>n.name.toLowerCase()===i.organizationCountry.toLowerCase());if(i&&(s.placeOfSupply||d(n=>({...n,placeOfSupply:p.billingState}))),t){const n=t.states;R(n)}else console.log("Country not found")}else console.log("No country selected")},u=t=>{const{name:n,value:a}=t.target,c=parseFloat(s==null?void 0:s.totalTax);let l=parseFloat(s.discountTransactionAmount)||0;const x=parseFloat(s.subtotalTotal+c)||0;if(n==="transactionDiscountType")if(d(o=>({...o,discountTransactionType:a})),a==="Percentage"){const o=l/x*100;o>100&&b.error("Discount cannot exceed 100%"),d(h=>({...h,discountTransactionAmount:o?o.toFixed(2):"0"}))}else{const o=l/100*x;d(h=>({...h,discountTransactionAmount:o?o.toFixed(2):"0"}))}if(n==="discountTransactionAmount")if(l=parseFloat(a)||0,s.discountTransactionType==="Percentage"){l>100&&(l=0,b.error("Discount cannot exceed 100%"));const o=l/100*x;d(h=>({...h,discountTransactionAmount:l?l.toString():"0",transactionDiscount:o?o.toFixed(2):"0"}))}else l>x&&(l=x,b.error("Discount cannot exceed the subtotal amount")),d(o=>({...o,discountTransactionAmount:l?l.toString():"0",transactionDiscount:l?l.toFixed(2):"0"}));n!=="discountTransactionAmount"&&n!=="transactionDiscountType"&&d(o=>({...o,[n]:a}))},B=((t,n,a)=>t.filter(c=>{var l;return(l=c[n])==null?void 0:l.toLowerCase().includes(a.toLowerCase())}))(g,"customerDisplayName",S);r.useEffect(()=>{(s==null?void 0:s.placeOfSupply)!==i.state?P(!0):P(!1)},[s==null?void 0:s.placeOfSupply,i.state]),r.useEffect(()=>{d(t=>({...t,totalDiscount:((parseFloat(t.totalItemDiscount)||0)+(parseFloat(t.transactionDiscount)||0)).toFixed(2)}))},[s.transactionDiscount,s.totalItemDiscount]),console.log(g),r.useEffect(()=>(N!==null?document.addEventListener("mousedown",D):document.removeEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}),[N]),r.useEffect(()=>{se(),W(),Q()},[i]),r.useEffect(()=>{const t=`${m.GET_ONE_ORGANIZATION}`;v(t,U,Y)},[]);const[y,L]=r.useState(!0),te=t=>{t.taxType==="GST"?L(!0):L(!1)};r.useEffect(()=>{p&&te(p)},[p]);const{id:A}=ce(),{request:ne}=f("get",5007);r.useEffect(()=>{(async()=>{const n=`${m.GET_ALL_CUSTOMER}`,a=`${m.GET_ONE_QUOTES}/${A}`;await v(n,O,_),j==="edit"&&await v(a,d,ne)})()},[j,A]),r.useEffect(()=>{if(s.customerId&&g){const t=g.find(n=>n._id===s.customerId);t&&F(t)}},[s]);const{request:ae}=f("post",5007),{request:le}=f("put",5007),re=async()=>{try{const t=j==="edit"?`${m.EDIT_SALES_QUOTE}/${A}`:`${m.ADD_SALES_QUOTE}`,n=j==="edit"?le:ae,{response:a,error:c}=await n(t,s);!c&&a?(b.success(a.data.message),k()):b.error(c==null?void 0:c.response.data.message)}catch{}};return console.log(s),e.jsxs("div",{className:"px-8",children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx(ie,{to:"/sales/quote",children:e.jsx("div",{className:"flex justify-center items-center h-11 w-11 bg-[#FFFFFF] rounded-full",children:e.jsx(de,{})})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsxs("h4",{className:"font-bold text-xl text-textColor ",children:[j=="edit"?"Edit":"Create"," Sales Quote"]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 py-5 rounded-lg",children:[e.jsx("div",{className:"col-span-8",children:e.jsx("div",{className:"bg-[#FFFFFF] p-5 min-h-max rounded-xl relative ",children:e.jsxs("div",{className:" mt-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:`col-span-${y?"5":"7"}`,children:[e.jsxs("label",{className:"text-sm mb-1 text-labelColor",children:["Customer Name ",e.jsx("span",{className:"text-[#bd2e2e] ",children:"*"})]}),e.jsxs("div",{className:"relative w-full",onClick:()=>K("customer"),children:[e.jsx("div",{className:`items-center flex appearance-none w-full h-9 text-zinc-400 bg-white border\r
                         border-inputBorder text-sm pl-2 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-gray-500 cursor-pointer`,children:e.jsx("p",{children:(p==null?void 0:p.customerDisplayName)??"Select Customer"})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(T,{color:"gray"})})]}),N==="customer"&&e.jsxs("div",{ref:C,className:"absolute z-10 bg-white  shadow  rounded-md mt-1 p-2   space-y-1 max-w-80 max-h-80 overflow-y-scroll",style:{width:"80%"},children:[e.jsx(ue,{searchValue:S,onSearchChange:$,placeholder:"Serach customer"}),B?B.map(t=>e.jsxs("div",{className:`grid grid-cols-12 gap-1 p-2 hover:bg-gray-100 cursor-pointer\r
                                border border-slate-400 rounded-lg bg-lightPink`,onClick:()=>{d(n=>({...n,customerId:t._id,customerDisplayName:t.customerDisplayName})),w(null),F(t)},children:[e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsx("img",{src:"https://i.postimg.cc/MHdYrGVP/Ellipse-43.png",alt:""})}),e.jsx("div",{className:"col-span-10 flex",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:t.customerDisplayName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Phone: ",t.mobile]})]})})]})):e.jsx(e.Fragment,{}),e.jsx("div",{className:"hover:bg-gray-100 cursor-pointer border border-slate-400 rounded-lg py-4",children:e.jsx(me,{page:"purchase"})})]})]}),y&&e.jsxs("div",{className:"col-span-7",children:[e.jsxs("label",{className:"block text-sm mb-1 text-labelColor",children:["Place Of Supply ",e.jsx("span",{className:"text-[#bd2e2e] ",children:"*"})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("select",{name:"placeOfSupply",onChange:u,value:s.placeOfSupply,className:`block appearance-none w-full h-9 text-zinc-400 bg-white border\r
        border-inputBorder text-sm pl-2 pr-8 rounded-md leading-tight\r
        focus:outline-none focus:bg-white focus:border-gray-500`,children:[e.jsx("option",{value:"",children:"Select place Of Supply"}),E&&E.map((t,n)=>e.jsx("option",{value:t,className:"text-gray",children:t},n))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(T,{color:"gray"})})]})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Quote#"}),e.jsx("div",{className:" flex items-center  rounded-lg border-inputBorder",children:e.jsx("input",{readOnly:!0,value:s.salesQuotes?s.salesQuotes:V,type:"text",className:"border-inputBorder w-full text-sm border rounded p-1.5 pl-2 h-9"})})]}),e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Reference#"}),e.jsx("input",{name:"reference",placeholder:"reference",type:"text",className:"border-inputBorder w-full text-sm border rounded p-1.5 pl-2 h-9",onChange:u,value:s.reference})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Quote Date"}),e.jsx("div",{className:"relative w-full",children:e.jsx("input",{name:"salesQuoteDate",onChange:u,value:s==null?void 0:s.salesQuoteDate,type:"date",className:"block appearance-none w-full h-9 text-zinc-400 bg-white border border-inputBorder text-sm pl-2 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-gray-500 px-2"})})]}),e.jsxs("div",{className:"col-span-7 relative",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Expiry Date"}),e.jsx("div",{className:"relative w-full",children:e.jsx("input",{name:"expiryDate",onChange:u,value:s==null?void 0:s.expiryDate,type:"date",className:"block appearance-none w-full h-9 text-zinc-400 bg-white border border-inputBorder text-sm pl-2 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-gray-500 px-2"})})]}),e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Subject"}),e.jsx("input",{name:"subject",value:s==null?void 0:s.subject,onChange:u,placeholder:"subject",type:"text",className:"border-inputBorder w-full text-sm border rounded p-1.5 pl-2 h-9"})]}),e.jsxs("div",{className:"relative col-span-7",children:[e.jsx("label",{htmlFor:"taxPreference",className:"text-slate-600 text-sm flex items-center gap-2",children:"Tax Preference"}),e.jsxs("div",{className:"relative w-full ",children:[e.jsxs("select",{className:"block appearance-none w-full mt-0.5 text-zinc-400 bg-white border border-inputBorder text-sm h-10 pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",name:"taxPreference",value:s.taxPreference,onChange:u,children:[e.jsx("option",{value:"Taxable",children:"Taxable"}),e.jsx("option",{value:"Non-taxable",children:"Non-taxable"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(T,{color:"gray"})})]})]})]}),e.jsx("p",{className:"font-bold",children:"Add Item"}),e.jsx(pe,{salesQuoteState:s,setSalesQuoteState:d,oneOrganization:i,isIntraState:I,isPlaceOfSupplyVisible:y}),e.jsx("br",{})]})})}),e.jsx("div",{className:"col-span-4 h-[70vh] overflow-scroll hide-scrollbar",children:e.jsxs("div",{className:"bg-secondary_main p-5 text-sm rounded-xl space-y-4 text-textColor",children:[e.jsx("div",{className:"text-sm",children:e.jsxs("label",{htmlFor:"",className:"",children:["Add Note",e.jsx("input",{onChange:u,value:s==null?void 0:s.note,name:"note",id:"",placeholder:"Note",className:"border-inputBorder w-full text-sm border rounded  p-2 h-[57px] mt-2 "})]})}),e.jsx("div",{className:"text-sm mt-3",children:e.jsxs("label",{htmlFor:"termsAndConditions",className:"",children:["Terms & Conditions",e.jsx("input",{onChange:u,value:s==null?void 0:s.tc,name:"tc",id:"termsAndConditions",placeholder:"Add Terms & Conditions of your business",className:"border-inputBorder w-full text-sm border rounded p-2 h-[57px] mt-2"})]})}),e.jsx("div",{className:"mt-4 hidden",children:e.jsxs("label",{className:"block mb-1",children:["Documents",e.jsxs("div",{className:"border-dashed border border-neutral-300 p-2 rounded  gap-2 text-center h-[68px] mt-2",children:[e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx(xe,{}),e.jsx("span",{children:"Upload File"})]}),e.jsx("p",{className:"text-xs mt-1 text-gray-600",children:"Maximum File Size : 1MB"})]}),e.jsx("input",{type:"file",className:"hidden",name:"documents"})]})}),e.jsxs("div",{className:" pb-4  text-dropdownText border-b-2 border-slate-200 space-y-2",children:[e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:"Sub Total"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsxs("p",{className:"text-end",children:["Rs"," ",s.subtotalTotal?s.subtotalTotal:"0.00"," "]})]})]}),e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:" Total Item"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsx("p",{className:"text-end",children:s.totalItem?s.totalItem:"0"})]})]}),e.jsxs("div",{className:"flex ",children:[e.jsx("div",{className:"w-[75%]",children:e.jsx("p",{children:" Total Discount"})}),e.jsx("div",{className:"w-full text-end",children:e.jsxs("p",{className:"text-end",children:[i.baseCurrency," ",s.totalDiscount?s.totalDiscount:"0.00"]})})]}),I?e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:" IGST"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsxs("p",{className:"text-end",children:[i.baseCurrency," ",s.igst?s.igst:"0.00"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:" SGST"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsxs("p",{className:"text-end",children:[i.baseCurrency," ",s.sgst?s.sgst:"0.00"]})]})]}),e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:" CGST"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsxs("p",{className:"text-end",children:[i.baseCurrency," ",s.cgst?s.cgst:"0.00"]})]})]})]}),e.jsxs("div",{className:"flex ",children:[e.jsxs("div",{className:"w-[75%]",children:[" ",e.jsx("p",{children:" Total Taxed Amount"})]}),e.jsxs("div",{className:"w-full text-end",children:[" ",e.jsxs("p",{className:"text-end",children:[" ",i.baseCurrency," ",s==null?void 0:s.totalTax]})]})]}),e.jsxs("div",{className:"flex justify-center items-center ",children:[e.jsx("div",{className:"w-[150%]",children:e.jsx("p",{children:"Bill Discount"})}),e.jsx("div",{className:" ",children:e.jsxs("div",{className:"border border-inputBorder rounded-lg flex items-center justify-center p-1 gap-1",children:[e.jsx("input",{onChange:u,value:s==null?void 0:s.discountTransactionAmount,name:"discountTransactionAmount",type:"number",step:"0.01",placeholder:"0",className:"w-[60px] focus:outline-none text-center"}),e.jsxs("select",{className:"text-xs text-zinc-400 bg-white relative",onChange:u,value:s==null?void 0:s.discountTransactionType,name:"transactionDiscountType",children:[e.jsx("option",{value:"Percentage",children:"%"}),e.jsx("option",{value:"Currency",children:i.baseCurrency})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center text-gray-700 ms-1",children:e.jsx(T,{color:"gray",height:15,width:15})})]})}),e.jsx("div",{className:"w-full text-end",children:e.jsxs("p",{className:"text-end",children:[i.baseCurrency," ",s.transactionDiscount?s.transactionDiscount:"0.00"]})})]})]}),e.jsxs("div",{className:"flex text-black",children:[e.jsxs("div",{className:"w-[75%] font-bold",children:[" ",e.jsx("p",{children:"Total"})]}),e.jsxs("div",{className:"w-full text-end font-bold text-base",children:[" ",e.jsx("p",{className:"text-end",children:(s==null?void 0:s.totalAmount)&&`${i.baseCurrency} ${s.totalAmount}`})]})]})]})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex gap-4 my-5 -mt-14 justify-end",children:[" ",e.jsx(z,{variant:"secondary",size:"sm",onClick:k,children:"Cancel"}),e.jsx(z,{variant:"primary",size:"sm",type:"submit",onClick:re,children:"Save & Send"})," "]})})]})};export{Ne as default};
