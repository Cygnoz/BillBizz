import{r as u,u as oe,j as t,am as ce,w as k,g as le,L as ie,P as q,T as re,_ as E,e as me}from"./index-A_edQTkL.js";import{S as K}from"./ScanEye-DNEuGJ6s.js";const de=({purchaseOrderState:x,setPurchaseOrderState:r,isInterState:i,oneOrganization:A})=>{var G;const[v,j]=u.useState(null),[h,c]=u.useState(null),[d,B]=u.useState(""),[I,M]=u.useState([]),{request:P}=oe("get",5003),F=u.useRef(null),[m,b]=u.useState([{itemId:"",itemName:"",itemQuantity:"",itemCostPrice:"",itemTax:"",itemDiscount:"",itemDiscountType:"percentage",itemAmount:"",itemSgst:"",itemCgst:"",itemIgst:"",itemVat:"",itemSgstAmount:"",itemCgstAmount:"",itemIgstAmount:"",itemVatAmount:"",taxPreference:"",purchaseAccountId:""}]),H=(e,s,o)=>{o.itemName||(j(n=>n===e?null:e),c(s))},Q=e=>{F.current&&!F.current.contains(e.target)&&(j(null),c(null))},z=()=>{const e={itemId:"",itemName:"",itemQuantity:"",itemCostPrice:"",itemTax:"",itemDiscount:"",itemDiscountType:"percentage",itemAmount:"",itemSgst:"",itemCgst:"",itemIgst:"",itemVat:"",itemSgstAmount:"",itemCgstAmount:"",itemIgstAmount:"",itemVatAmount:"",taxPreference:"",purchaseAccountId:""},s=[...m,e];b(s)},J=(e,s)=>{j(null),c(null);const o=[...m];o[s].itemName=e.itemName,o[s].itemImage=e.itemImage,o[s].itemCostPrice=e.costPrice?e.costPrice:0,o[s].itemQuantity=1,o[s].itemId=e._id,o[s].itemCgst=e.cgst,o[s].itemSgst=e.sgst,o[s].itemIgst=e.igst,o[s].taxPreference=e.taxPreference,o[s].purchaseAccountId=e.purchaseAccountId;const n=Number(o[s].itemCostPrice),l=Number(o[s].itemDiscount),a=o[s].itemDiscountType,g=V(n,l,a),N=_(g,o[s],i,o[s].taxPreference),{itemAmount:p,cgstAmount:f,sgstAmount:D,igstAmount:T}=N;o[s].itemAmount=i?(p+T).toFixed(2):(p+f+D).toFixed(2),o[s].itemCgstAmount=i?"":f,o[s].itemSgstAmount=i?"":D,o[s].itemIgstAmount=i?T:"",o[s].itemTax=i?T:f+D,b(o),r==null||r(R=>({...R,items:o.map(w=>{const y={...w};return delete y.itemImage,y})}))},V=(e,s,o,n)=>{let l=typeof s=="string"?Number(s):s;if(l<0)return E.error("Discount cannot be negative"),e;const a=e;return o==="percentage"?(l>100&&(l=100,E.error("Discount cannot exceed 100%")),a-a*l/100):(l>a&&(l=a,E.error("Discount cannot exceed the total item amount")),a-l)},_=(e,s,o,n)=>{if(n==="Non-taxable")return{itemAmount:e,cgstAmount:0,sgstAmount:0,igstAmount:0};const{itemCgst:l=0,itemSgst:a=0,itemIgst:g=0}=s;if(o){const f=e*Number(g)/100;return{itemAmount:e,cgstAmount:0,sgstAmount:0,igstAmount:Number(f)}}const N=e*Number(l)/100,p=e*Number(a)/100;return{itemAmount:e,sgstAmount:Number(p),cgstAmount:Number(N),igstAmount:0}},C=(e,s,o)=>{const n=[...m];n[e]={...n[e],[s]:o};const l=Number(n[e].itemQuantity)||0,a=Number(n[e].itemCostPrice)||0,g=l*a,N=n[e].taxPreference;let p=Number(n[e].itemDiscount)||0;const f=n[e].itemDiscountType;f==="percentage"?p>100&&(p=100,n[e].itemDiscount="100",E.error("Discount cannot exceed 100%")):p>g&&(p=g,n[e].itemDiscount=g.toString(),E.error("Discount cannot exceed the total cost price"));const D=V(g,p,f),T=_(D,n[e],i,N),{itemAmount:R,cgstAmount:w,sgstAmount:y,igstAmount:L}=T;n[e].itemAmount=i?(R+L).toFixed(2):(R+w+y).toFixed(2),n[e].itemCgstAmount=i?"":w,n[e].itemSgstAmount=i?"":y,n[e].itemIgstAmount=i?L:"",n[e].itemTax=i?L:w+y,b(n),r==null||r(se=>({...se,items:n.map(ne=>{const $={...ne};return delete $.itemImage,$})}))},U=async()=>{try{const e=`${me.GET_ALL_ITEM}`,s=await P(e),{response:o,error:n}=s;!n&&o?M(o.data):console.log(n)}catch(e){console.error("Error fetching items:",e)}},W=e=>{if(m.length>1){const s=m.filter((o,n)=>n!==e);b(s),r==null||r(o=>({...o,items:s}))}else{const s={itemId:"",itemName:"",itemQuantity:"",itemCostPrice:"",itemTax:"",itemDiscount:"",itemDiscountType:"percentage",itemAmount:"",itemSgst:"",itemCgst:"",itemIgst:"",itemVat:"",itemSgstAmount:"",itemCgstAmount:"",itemIgstAmount:"",itemVatAmount:"",taxPreference:"",purchaseAccountId:""};b([s]),r==null||r(o=>({...o,items:[s]}))}},X=()=>m.reduce((e,s)=>{const o=i?0:Number(s.itemSgstAmount)||0;return e+o},0),Y=()=>m.reduce((e,s)=>{const o=i?0:Number(s.itemCgstAmount)||0;return e+o},0),Z=()=>m.reduce((e,s)=>{const o=i&&Number(s.itemIgstAmount)||0;return e+o},0),S=()=>m.reduce((e,s)=>{const o=parseFloat(s.itemQuantity.toString()||"0");return e+o},0),O=()=>{const e=m.reduce((o,n)=>{const l=Number(n.itemDiscount)||0,a=Number(n.itemQuantity)||0,N=(Number(n.itemCostPrice)||0)*a;return n.itemDiscountType==="percentage"?o+N*l/100:o+l},0);return Math.round(e*100)/100},ee=()=>m.reduce((e,s)=>{const o=Number(s.itemQuantity)||0,n=Number(s.itemCostPrice)||0,l=o*n;return e+l},0),te=()=>I.filter(e=>!m.find(o=>o.itemId===e._id)&&e.itemName.toLowerCase().includes(d.toLowerCase()));return u.useEffect(()=>(v!==null?document.addEventListener("mousedown",Q):document.removeEventListener("mousedown",Q),()=>{document.removeEventListener("mousedown",Q)}),[v]),u.useEffect(()=>{const e=m==null?void 0:m.map(s=>{const o=V((Number(s.itemCostPrice)||0)*(Number(s.itemQuantity)||0),Number(s.itemDiscount)||0,s.itemDiscountType),n=_(o,s,i,s.taxPreference);return console.log(n.itemAmount,"item"),{...s,itemAmount:i?n.itemAmount+n.igstAmount:n.itemAmount+n.cgstAmount+n.sgstAmount,itemCgstAmount:n.cgstAmount>0?n.cgstAmount:0,itemSgstAmount:n.sgstAmount>0?n.sgstAmount:0,itemIgstAmount:n.igstAmount>0?n.igstAmount:0,taxPreference:s.taxPreference}});b(e),r==null||r(s=>({...s,items:e==null?void 0:e.map(o=>{const n={...o};return delete n.itemImage,n})}))},[i]),u.useEffect(()=>{const e=m==null?void 0:m.map(s=>({...s,itemDiscountType:"percentage",itemDiscount:0}));b(e),r==null||r(s=>({...s,items:e==null?void 0:e.map(o=>{const n={...o};return delete n.itemImage,n})}))},[]),u.useEffect(()=>{const e=S(),s=X(),o=Y(),n=Z(),l=ee(),a=O();r==null||r(g=>({...g,totalItem:e,sgst:i?"":s,cgst:i?"":o,igst:i?n:"",subTotal:l,itemTotalDiscount:a<=0?"":a,totalTaxAmount:i?n:s+o}))},[m]),u.useEffect(()=>{x&&b(x.items)},[x.orderNumber,x.items]),console.log(m,"rows"),u.useEffect(()=>{b(e=>Array.isArray(e)?e==null?void 0:e.map(s=>({...s,itemDiscountType:"percentage",itemDiscount:""})):[])},[]),u.useEffect(()=>{U()},[]),t.jsxs("div",{children:[t.jsx("div",{className:"rounded-lg border-2 border-tableBorder mt-5",children:t.jsxs("table",{className:"min-w-full bg-white rounded-lg relative pb-4 border-dropdownText",children:[t.jsx("thead",{className:"text-[12px] text-center text-dropdownText",children:t.jsx("tr",{className:"bg-lightPink",children:(G=ce)==null?void 0:G.map((e,s)=>t.jsx("th",{className:"py-2 px-4 font-medium border-b border-tableBorder relative",children:e},s))})}),t.jsx("tbody",{className:"text-dropdownText text-center text-[13px] ",children:m==null?void 0:m.map((e,s)=>{var o;return t.jsxs("tr",{children:[t.jsx("td",{className:"border-y py-3 px-2 border-tableBorder",children:s+1}),t.jsxs("td",{className:"border-y py-3 px-2 border-tableBorder",children:[t.jsx("div",{className:"relative w-full",onClick:()=>H(s,"searchProduct",e),children:e.itemName?t.jsxs("div",{className:"cursor-pointer gap-2 grid grid-cols-12 appearance-none items-center justify-center h-9 text-zinc-400 bg-white text-sm",children:[t.jsx("div",{className:"flex items-start col-span-4",children:t.jsx("img",{className:"rounded-full h-10 w-10 ",src:e.itemImage,alt:""})}),t.jsx("div",{className:"col-span-8  text-start",children:t.jsx("p",{className:"text-textColor",children:e.itemName})})]}):t.jsxs("div",{className:"cursor-pointer flex appearance-none items-center justify-center h-9 text-zinc-400 bg-white text-sm",children:[t.jsx("p",{children:"Type or click"}),t.jsx(k,{color:"currentColor"})]})}),v===s&&h==="searchProduct"&&t.jsxs("div",{ref:F,className:"absolute z-10 bg-white shadow rounded-md mt-1 p-2 w-[30%] space-y-1 h-72 overflow-scroll hide-scrollbar",children:[t.jsx(le,{searchValue:d,onSearchChange:B,placeholder:"Search Item"}),I.length>0?(o=te())==null?void 0:o.map((n,l)=>t.jsxs("div",{className:"grid grid-cols-12 gap-1 p-2 hover:bg-gray-100 cursor-pointer border border-slate-400 rounded-lg bg-lightPink hover:bg-lightRose",onClick:()=>J(n,s),children:[t.jsx("div",{className:"col-span-2 flex justify-center",children:t.jsx("img",{className:"rounded-full h-10",src:n.itemImage,alt:"Img"})}),t.jsx("div",{className:"col-span-10 flex",children:t.jsxs("div",{className:"text-start flex-row space-y-1",children:[t.jsx("p",{className:"font-bold text-sm text-black",children:n.itemName}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Rate: ",n.costPrice]})]})})]},l)):t.jsx("div",{className:"text-center border-slate-400 border rounded-lg",children:t.jsx("p",{className:"text-[red] text-sm py-4",children:"Items Not Found!"})}),t.jsx("div",{children:t.jsx(ie,{to:"/inventory/Item/new",children:t.jsxs("button",{className:"bg-darkGreen text-darkRed rounded-lg py-4 px-6 flex items-center text-sm font-bold border-slate-400 border gap-2 w-full hover:bg-lightRed",children:[t.jsx(q,{color:"darkRed"}),t.jsx("p",{children:" Add New Item"})]})})})]})]}),t.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:t.jsx("input",{type:"text",placeholder:"0",className:"w-[50px] focus:outline-none text-center",value:e.itemQuantity||"",onChange:n=>{const l=n.target.value;/^\d*$/.test(l)&&C(s,"itemQuantity",l)}})}),t.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:t.jsx("input",{type:"text",placeholder:"0",className:"w-[50px]  focus:outline-none text-center",value:e.itemCostPrice,onChange:n=>{const l=n.target.value;/^\d*$/.test(l)&&C(s,"itemCostPrice",l)}})}),t.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:t.jsx("input",{disabled:!0,type:"text",placeholder:"0",className:"w-[50px] focus:outline-none text-center",value:i?(e.itemIgstAmount||0)===0?"-":e.itemIgstAmount:(e.itemCgstAmount||0)+(e.itemSgstAmount||0)===0?"-":e.itemCgstAmount+e.itemSgstAmount})}),t.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[t.jsx("input",{type:"text",placeholder:"0",className:"w-[50px] focus:outline-none text-center",value:e.itemDiscount,onChange:n=>{const l=n.target.value;/^\d*\.?\d*$/.test(l)&&C(s,"itemDiscount",l)}}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{onChange:n=>C(s,"itemDiscountType",n.target.value),value:e.itemDiscountType,className:"text-xs appearance-none w-[60px] p-1 text-zinc-400 bg-white border border-inputBorder rounded-lg",children:[t.jsx("option",{value:"percentage",children:"%"}),t.jsx("option",{value:"currency",children:A==null?void 0:A.baseCurrency})]}),t.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:t.jsx(k,{color:"gray",height:15,width:15})})]})]})}),t.jsx("td",{className:"py-2.5 px- border-y border-tableBorder",children:t.jsx("input",{disabled:!0,type:"text",placeholder:"0",className:"focus:outline-none text-center",value:e.itemAmount,onChange:n=>C(s,"itemAmount",n.target.value)})}),t.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:t.jsx("div",{className:"text-center flex justify-center gap-2",onClick:()=>W(s),children:t.jsx(re,{color:"darkRed"})})})]},s)})})]})}),t.jsx("div",{className:"w-[60%] mt-0",children:t.jsxs("button",{type:"button",className:"bg-darkGreen text-darkRed rounded-lg py-5 flex items-center text-sm font-bold",onClick:z,children:[t.jsx(q,{color:"darkRed"}),"Add Item"]})})]})},xe=({purchaseOrderState:x,setPurchaseOrderState:r,page:i,allAccounts:A})=>{const[v,j]=u.useState(!1),h=c=>{const{name:d,value:B}=c.target;r(I=>({...I,[d]:B}))};return t.jsx(t.Fragment,{children:v?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>j(!1),className:"flex items-center text-textColor font-semibold text-sm",children:[t.jsx(K,{})," View Less Details"]}),t.jsxs("div",{className:`${i=="bill"?"grid grid-cols-3 gap-4 my-4 text-textColor text-sm":"grid grid-cols-2 gap-4 my-4 text-textColor text-sm"}`,children:[i==="bill"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Other Expense Account ID"}),t.jsxs("div",{className:"relative w-full",children:[t.jsxs("select",{onChange:h,value:x.otherExpenseAccountId,name:"otherExpenseAccountId",className:"block appearance-none w-full text-[#495160] bg-white border border-inputBorder text-sm h-9 pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",children:[t.jsx("option",{value:"",selected:!0,hidden:!0,disabled:!0,children:"Select Account"}),A.filter(c=>c.accountHead==="Expenses").map(c=>t.jsx("option",{value:c._id,children:c.accountName},c._id))]}),t.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:t.jsx(k,{color:"gray"})})]})]}),t.jsx("div",{className:"text-sm",children:t.jsxs("label",{htmlFor:"otherExpense",className:"",children:["Other Expense Amount",t.jsx("input",{type:"text",value:x.otherExpenseAmount||"",name:"otherExpenseAmount",onChange:c=>{const d=c.target.value;(/^\d*\.?\d{0,2}$/.test(d)||d==="")&&h(c)},onKeyDown:c=>{["e","E","+","-"].includes(c.key)&&c.preventDefault()},placeholder:"Enter expense amount",className:"border-inputBorder w-full text-sm border rounded p-2 h-9 mt-1 text-[#495160]"})]})}),t.jsx("div",{className:"text-sm",children:t.jsxs("label",{htmlFor:"otherExpenseReason",className:"",children:["Other Expense Reason",t.jsx("input",{value:x.otherExpenseReason,name:"otherExpenseReason",onChange:h,placeholder:"Enter reason",className:"border-inputBorder w-full text-sm border rounded p-2 h-9 mt-1"})]})}),i==="bill"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Freight Account"}),t.jsxs("div",{className:"relative w-full",children:[t.jsxs("select",{onChange:h,value:x.freightAccountId,name:"freightAccountId",className:"block appearance-none w-full text-[#495160] bg-white border border-inputBorder text-sm h-[39px] pl-3 pr-8 rounded-md leading-tight focus:outline-none focus:bg-white focus:border-darkRed",children:[t.jsx("option",{value:"",selected:!0,hidden:!0,disabled:!0,children:"Select Account"}),A.filter(c=>c.accountSubhead==="Expense").map(c=>t.jsx("option",{value:c._id,children:c.accountName},c._id))]}),t.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:t.jsx(k,{color:"gray"})})]})]}),t.jsx("div",{className:"text-sm",children:t.jsxs("label",{htmlFor:"freight",className:"",children:["Freight Amount",t.jsx("input",{type:"number",step:"0.01",value:x.freightAmount||"",name:"freightAmount",onChange:c=>{const d=c.target.value;(/^\d*\.?\d{0,2}$/.test(d)||d==="")&&h(c)},onKeyDown:c=>{["e","E","+","-"].includes(c.key)&&c.preventDefault()},placeholder:"Enter freight amount",className:"border-inputBorder w-full text-sm border rounded p-2 h-9 mt-1"})]})}),t.jsx("div",{className:"text-sm",children:t.jsxs("label",{htmlFor:"roundOff",className:"",children:["Round Off Amount",t.jsx("input",{type:"text",step:"0.01",value:x.roundOffAmount||"",name:"roundOffAmount",onChange:c=>{const d=c.target.value;(/^\d*\.?\d{0,2}$/.test(d)||d==="")&&h(c)},onKeyDown:c=>{["e","E","+","-"].includes(c.key)&&c.preventDefault()},placeholder:"Enter round-off amount",className:"border-inputBorder w-full text-sm border rounded p-2 h-9 mt-1"})]})}),t.jsx("div",{className:"text-sm",children:t.jsxs("label",{htmlFor:"vehicleNo",className:"",children:["Vehicle Number",t.jsx("input",{value:x.vehicleNo,name:"vehicleNo",onChange:h,placeholder:"Enter vehicle number",className:"border-inputBorder w-full text-sm border rounded p-2 h-9 mt-1"})]})})]})]}):t.jsxs("button",{onClick:()=>j(!0),className:"flex items-center text-textColor font-semibold text-sm",children:[t.jsx(K,{})," View More"]})})};export{de as N,xe as V};
