import{a as W,j as e,B as P,Q as Y,r as n,u as w,I as se,g as H,a1 as re,E as te,T as U,W as ae,e as A,_ as u,M as X,U as le,P as oe}from"./index-A_edQTkL.js";import{C as ne}from"./CategoryModal-BKJcThJi.js";import{T as ie}from"./TableSkelton-L9YeclyQ.js";import{N as de}from"./NoDataFoundTable-hmwFq4Ia.js";import{P as ce}from"./PrintButton-wNIz7Qro.js";import{P as xe}from"./Pagination-CosxQtyN.js";import{P as Q}from"./PencilEdit-YyKjeo-p.js";import"./NO_DATA-Bek3dUYY.js";import"./PrinterIcon-wSfdPfNy.js";const pe=({})=>{const p=W(),j=()=>{p("/expense/add-expense")};return e.jsx("div",{children:e.jsx("div",{children:e.jsxs(P,{onClick:j,variant:"primary",className:"flex items-center",size:"sm",children:[e.jsx(Y,{color:"white",size:"14"})," ",e.jsx("p",{className:"text-md",children:"Add Expense"})]})})})},me=()=>{const[p,j]=n.useState(""),[g,_]=n.useState(1),[c,T]=n.useState([]),{request:b}=w("get",5008),{loading:m,setLoading:i}=n.useContext(se),S=W(),[f,N]=n.useState(!1),[D,y]=n.useState(null),B=s=>{y(s),N(!0)},C=10,[d,L]=n.useState([{id:"expenseDate",label:"Date",visible:!0},{id:"expense.expenseAccount",label:"Name",visible:!0},{id:"expenseCategory",label:"Category",visible:!0},{id:"supplierDisplayName",label:"Vendor Name",visible:!0},{id:"paidThrough",label:"Paid Through",visible:!0},{id:"grandTotal",label:"Amount",visible:!0}]),x=c==null?void 0:c.filter(s=>{var o,k,v,E,F,z,O,I,G,V,q,R;const l=p.toLowerCase().trim();return((v=(k=(o=s==null?void 0:s.expenseAccount)==null?void 0:o.toLowerCase())==null?void 0:k.trim())==null?void 0:v.startsWith(l))||((z=(F=(E=s==null?void 0:s.expenseCategory)==null?void 0:E.toLowerCase())==null?void 0:F.trim())==null?void 0:z.startsWith(l))||((G=(I=(O=s==null?void 0:s.expenseDate)==null?void 0:O.toLowerCase())==null?void 0:I.trim())==null?void 0:G.startsWith(l))||((R=(q=(V=s==null?void 0:s.supplierDisplayName)==null?void 0:V.toLowerCase())==null?void 0:q.trim())==null?void 0:R.startsWith(l))}),r=Math.ceil((x==null?void 0:x.length)/C),t=x==null?void 0:x.slice((g-1)*C,g*C),a=s=>{_(s)},$=[...d==null?void 0:d.filter(s=>s.visible),{},{},{}],M=async()=>{try{i({...m,skeleton:!0,noDataFound:!1});const s=`${A.GET_ALL_EXPENSE}`,{response:l,error:o}=await b(s);!o&&l?(console.log("Fetched Expenses:",l.data),T(l.data),i({...m,skeleton:!1,noDataFound:!1})):(console.log("Error fetching data:",o),i({...m,skeleton:!1,noDataFound:!0}))}catch(s){console.error("API call error:",s),i({...m,skeleton:!1,noDataFound:!0})}};n.useEffect(()=>{M()},[]);const J=(s,l)=>{const o=s.split(".");let k=o.reduce((v,E)=>v?v[E]:void 0,l);return o[0]==="expense"&&Array.isArray(l.expense)&&(k=l.expense.map((v,E)=>e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:v[o[1]]||"-"})},E))),k||e.jsx("span",{className:"text-gray-500 italic",children:"-"})},K=s=>{S(`/expense/edit-expense/${s}`)},{request:Z}=w("delete",5008),ee=async()=>{if(D)try{const s=`${A.DELETE_EXPENSE}/${D}`,{response:l,error:o}=await Z(s);!o&&l?(u.success(l.data.message),M()):u.error(o.response.data.message)}catch{u.error("Error occurred while deleting.")}finally{N(!1),y(null)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 justify-between",children:[e.jsx(H,{placeholder:"Search Expense",searchValue:p,onSearchChange:s=>{j(s),_(1)}}),e.jsx(ce,{})]}),e.jsx("div",{className:"overflow-x-auto mt-3 hide-scrollbar overflow-y-scroll max-h-[25rem]",children:e.jsxs("table",{className:"min-w-full bg-white mb-5",children:[e.jsx("thead",{className:"text-[12px] text-center text-dropdownText",children:e.jsxs("tr",{style:{backgroundColor:"#F9F7F0"},children:[e.jsx("th",{className:"py-3 px-4 border-b border-tableBorder",children:"Sl.No."}),d==null?void 0:d.map(s=>s.visible&&e.jsx("th",{className:"py-2 px-4 font-medium border-b border-tableBorder",children:s.label},s.id)),e.jsx("th",{className:"py-3 px-2 font-medium border-b border-tableBorder",children:"Action"}),e.jsx("th",{className:"py-3 px-2 font-medium border-b border-tableBorder",children:e.jsx(re,{columns:d,setColumns:L,tableId:"expense"})})]})}),e.jsx("tbody",{className:"text-dropdownText text-center text-[13px]",children:m.skeleton?[...Array(C)].map((s,l)=>e.jsx(ie,{columns:$},l)):t&&t.length>0?t.map((s,l)=>e.jsxs("tr",{className:"relative cursor-pointer",children:[e.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder",children:(g-1)*C+l+1}),d.map(o=>o.visible&&e.jsx("td",{className:"py-2.5 px-4 border-y border-tableBorder text-center",children:J(o.id,s)},o.id)),e.jsxs("td",{className:"py-3 px-4 border-b border-tableBorder gap-3 flex items-center justify-center",children:[e.jsx("div",{onClick:()=>K(s._id),children:e.jsx(Q,{color:"#0B9C56",className:"cursor-pointer"})}),e.jsx("div",{onClick:()=>S(`/expense/view/${s._id}`),children:e.jsx(te,{color:"#569FBC",className:"cursor-pointer"})}),e.jsx("div",{onClick:()=>B(s._id),children:e.jsx(U,{color:"red"})})]}),e.jsx("td",{className:"py-3 px-4 border-b border-tableBorder"})]},s.id)):e.jsx(de,{columns:$})})]})}),e.jsx(xe,{currentPage:g,totalPages:r,onPageChange:a}),e.jsx(ae,{open:f,onClose:()=>N(!1),onConfirm:ee,message:"Are you sure you want to delete?"})]})};function he({}){const{request:p}=w("post",5008),{request:j}=w("put",5008),{request:g}=w("delete",5008),{request:_}=w("get",5008),[c,T]=n.useState([]),[b,m]=n.useState({expenseCategory:"",description:""}),[i,S]=n.useState({main:!1,add:!1,edit:!1}),f=(r,t,a)=>{S({main:r,edit:a,add:t})},N=(r,t,a)=>{S({main:r,edit:a,add:t})},D=async()=>{try{const r=i.edit?`${A.UPDATE_EXPENSE_CATEGORY}/${b._id}`:`${A.ADD_EXPENSE_CATEGORY}`,t=i.edit?j:p,{response:a,error:h}=await t(r,b);console.log("res",a),console.log("err",h),!h||a?(u.success(`Category ${i.edit?"updated":"added"} successfully.`),f(!0,!1,!1),m({expenseCategory:"",description:"",_id:""}),y()):(u.error(h.response.data.message),console.error(`Error saving category: ${h.message}`))}catch(r){u.error("Error in save operation."),console.error("Error in save operation",r)}},y=async()=>{try{const r=`${A.GET_ALL_EXPENSE_CATEGORY}`,{response:t,error:a}=await _(r);!a&&t?(console.log("fs",t.data),T(t.data)):console.error("Failed to fetch Category data.")}catch(r){u.error("Error in fetching Category data."),console.error("Error in fetching Category data",r)}},B=async r=>{try{const t=`${A.DELETE_EXPENSE_CATEGORY}/${r}`,{response:a,error:h}=await g(t);!h||a?(u.success(a==null?void 0:a.data.message),c.length==1&&T([]),y()):console.error("Failed to fetch Category data.")}catch(t){u.error("Error in delete Category data."),console.error("Error in delete Category data",t)}};n.useEffect(()=>{y()},[]),console.log("all",c);const C=r=>{const{name:t,value:a}=r.target;m(h=>({...h,[t]:a})),console.log(b)},[d,L]=n.useState(""),x=c==null?void 0:c.filter(r=>{var t,a;return((t=r.expenseCategory)==null?void 0:t.toLowerCase().includes(d.toLowerCase()))||((a=r.description)==null?void 0:a.toLowerCase().includes(d.toLowerCase()))});return e.jsxs("div",{children:[e.jsxs(P,{variant:"secondary",className:"flex items-center",size:"sm",onClick:()=>N(!0,!1,!1),children:[e.jsx(Y,{color:"currentColor",size:"14"})," ",e.jsx("p",{className:"text-md",children:"Add Category"})]}),e.jsx(X,{open:i.main,onClose:()=>f(!1,!1,!1),className:"w-[65%]",children:e.jsxs("div",{className:"p-5 mt-3",children:[e.jsxs("div",{className:"mb-5 flex p-4 rounded-xl bg-CreamBg relative overflow-hidden h-24",children:[e.jsx("div",{className:"absolute top-0 right-12 h-24 w-[200px] bg-cover bg-no-repeat",style:{backgroundImage:`url(${le})`}}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-textColor",children:"Manage Category"}),e.jsx("p",{className:"text-dropdownText font-semibold text-sm mt-2",children:"Have an insight on the profit or loss incurred due to the change in exchange rates"})]}),e.jsx("div",{className:"ms-auto text-3xl cursor-pointer relative z-10",onClick:()=>f(!1,!1,!1),children:"×"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"grid grid-flow-col items-center gap-3 ",children:e.jsx("div",{className:"w-96",children:e.jsx(H,{placeholder:"Search Name or Description",searchValue:d,onSearchChange:L})})}),e.jsx("div",{className:"flex ml-auto me-2 my-4",children:e.jsxs(P,{variant:"primary",size:"xl",onClick:()=>N(!0,!0,!1),children:[e.jsx(oe,{color:"white"}),e.jsx("p",{className:"text-sm",children:"Add Category"})]})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-5",children:c.length===0?e.jsx("p",{className:"text-center col-span-3 text-red-500 font-semibold",children:"No categories found !"}):x==null?void 0:x.map(r=>e.jsx("div",{className:"flex p-2",children:e.jsxs("div",{className:"border border-slate-200 text-textColor rounded-xl w-96 h-auto p-3 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold",children:r.expenseCategory}),e.jsx("p",{className:"text-xs text-textColor",children:r.description})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("p",{className:"cursor-pointer",onClick:()=>{N(!0,!1,!0),m({expenseCategory:r.expenseCategory,description:r.description,_id:r._id})},children:e.jsx(Q,{color:"currentColor"})}),e.jsx("p",{className:"cursor-pointer",onClick:()=>B(r==null?void 0:r._id),children:e.jsx(U,{color:"currentColor"})})]})]})},r._id))}),e.jsx(X,{open:i.edit?i.edit:i.add,onClose:()=>f(!0,!1,!1),style:{width:"35%"},children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex p-4 rounded-xlrelative overflow-hidden h-24",children:[e.jsx("div",{className:"relative z-10",children:e.jsxs("h3",{className:"text-xl font-bold text-textColor",children:[i.edit?"Edit":"Add"," Category"]})}),e.jsx("div",{className:"ms-auto text-3xl cursor-pointer relative z-10",onClick:()=>f(!0,!1,!1),children:"×"})]}),e.jsxs("form",{className:"grid gap-5",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Name"}),e.jsx("input",{type:"text",placeholder:"Enter category name",name:"expenseCategory",value:b.expenseCategory,onChange:C,className:"w-full h-10 px-3 mt-1 text-sm bg-white border border-inputBorder rounded-md focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm mb-1 text-labelColor",children:"Description"}),e.jsx("textarea",{rows:4,placeholder:"Enter description",name:"description",value:b.description,onChange:C,className:"border-inputBorder w-full text-sm border rounded p-1.5 pl-2 "})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"secondary",size:"sm",className:"text-sm pl-6 pr-6",onClick:()=>f(!0,!1,!1),children:"Cancel"})," ",e.jsx(P,{variant:"primary",size:"sm",className:"text-sm pl-8 pr-8",onClick:D,children:"Save"})]})]})]})})]})})]})}const Ee=({})=>{const[p,j]=n.useState(!1),g=()=>{j(!p)};return e.jsxs("div",{className:"mx-6 my-4 text-textColor space-y-5",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-2xl text-textColor",children:"Expense"}),e.jsx("p",{className:"text-sm text-gray mt-1",children:"Gain a clear understanding of your financial outflows with the Expense Overview section."})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsx(he,{}),e.jsx(pe,{})]})]}),e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(me,{})}),e.jsx(ne,{isOpen:p,onClose:g,page:"expense"})]})};export{Ee as default};
